<!DOCTYPE html>
<html lang="en">
<!-- ***IMPORTANT***: This page is autogenerated from a markdown file
         DO NOT EDIT THIS FILE DIRECTLY.
	 Your edits will disappear when this page is regenerated  -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        code{white-space: pre-wrap;}
        span.smallcaps{font-variant: small-caps;}
        span.underline{text-decoration: underline;}
        div.line-block{white-space: pre-line;}
        div.column{display: inline-block; vertical-align: top; width: 50%;}
        pre{background-color:#e7e7e7; border: solid 1px #000000; padding: 5px;}
        code{background-color:#e7e7e7; padding: 1px;}
        code.sourceCode > span { display: inline-block; line-height: 1.25; }
        code.sourceCode > span { color: inherit; text-decoration: inherit; }
        code.sourceCode > span:empty { height: 1.2em; }
        .sourceCode { overflow: visible; }
        code.sourceCode { white-space: pre; position: relative; }
        div.sourceCode { margin: 1em 0; }
        pre.sourceCode { margin: 0; }
        @media screen {
        div.sourceCode { overflow: auto; }
        }
        @media print {
        code.sourceCode { white-space: pre-wrap; }
        code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
        }
        pre.numberSource code
          { counter-reset: source-line 0; }
        pre.numberSource code > span
          { position: relative; left: -4em; counter-increment: source-line; }
        pre.numberSource code > span > a:first-child::before
          { content: counter(source-line);
            position: relative; left: -1em; text-align: right; vertical-align: baseline;
            border: none; display: inline-block;
            -webkit-touch-callout: none; -webkit-user-select: none;
            -khtml-user-select: none; -moz-user-select: none;
            -ms-user-select: none; user-select: none;
            padding: 0 4px; width: 4em;
            color: #aaaaaa;
          }
        pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
        div.sourceCode
          {   }
        @media screen {
        code.sourceCode > span > a:first-child::before { text-decoration: underline; }
        }
        code span.al { color: #ff0000; } /* Alert */
        code span.an { color: #008000; } /* Annotation */
        code span.at { } /* Attribute */
        code span.bu { } /* BuiltIn */
        code span.cf { color: #0000ff; } /* ControlFlow */
        code span.ch { color: #008080; } /* Char */
        code span.cn { } /* Constant */
        code span.co { color: #008000; } /* Comment */
        code span.cv { color: #008000; } /* CommentVar */
        code span.do { color: #008000; } /* Documentation */
        code span.er { color: #ff0000; font-weight: bold; } /* Error */
        code span.ex { } /* Extension */
        code span.im { } /* Import */
        code span.in { color: #008000; } /* Information */
        code span.kw { color: #0000ff; } /* Keyword */
        code span.op { } /* Operator */
        code span.ot { color: #ff4000; } /* Other */
        code span.pp { color: #ff4000; } /* Preprocessor */
        code span.sc { color: #008080; } /* SpecialChar */
        code span.ss { color: #008080; } /* SpecialString */
        code span.st { color: #008080; } /* String */
        code span.va { } /* Variable */
        code span.vs { color: #008080; } /* VerbatimString */
        code span.wa { color: #008000; font-weight: bold; } /* Warning */
        .sourceCode{overflow: auto;}
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body, {delimiters: [ {left: '\\[', right: '\\]', display: true}, {left: '$$', right: '$$', display: true}, {left: '\\(', right: '\\)', display: false}, {left: '$', right: '$', display: false} ]});"></script>
    <link rel="stylesheet" href="/libs/fonts/fonts.css">
    <link rel="stylesheet" href="/libs/css/pandoc.css">
    <title>CS144: Web Applications</title>
</head>
<body>
<h1 id="project-4-markdown-editor-using-angular">Project 4: Markdown Editor Using Angular</h1>
<h2 id="change-history">Change History</h2>
<p>We now requires specific <code>id</code> attributes values for various HTML elements in your Angular App. In particular, we are requiring the following:</p>
<ol type="1">
<li>The “New Post” button in the List component should have the <code>id</code> attribute <code>list-new-button</code>.</li>
<li>Each blog post entry appearing in the List component should be in an HTML element with <code>id="list-post-:postid"</code> where <code>:postid</code> is the <code>postid</code> of the post.</li>
<li>The “Save”, “Delete”, and “Preview” buttons in the Edit component must have <code>id</code> attributes, <code>edit-save-button</code>, <code>edit-delete-button</code> and <code>edit-preview-button</code>, respectively.</li>
<li>The title and body input boxes/text areas in the Edit component must have <code>id</code> attributes, <code>edit-title</code> and <code>edit-body</code>, respectively.</li>
<li>The “Edit” button in the Preview component must have <code>id="preview-edit-button"</code>.</li>
<li>The rendered title and body in the Preview component must appear in HTML elements with the <code>id</code>s, <code>preview-title</code> and <code>preview-body</code>, respectively.</li>
</ol>
<p>Because your code will be autograded now, you are no longer required to submit a video that demonstrates the functionality of your code.</p>
<h2 id="overview">Overview</h2>
<p>In this project, you will learn and use <a href="https://angular.io/">Angular</a>, a popular front-end web-development framework, to develop a more advanced and dynamic version of the markdown blog editor that uses the REST API you implemented in Project 3 to help users write, update, and publish blogs on the server.</p>
<h2 id="development-environment">Development Environment</h2>
<p>The development for Project 4 will be done using the same docker container that you created in Project 3, which can be started with the command:</p>
<pre class="term"><code>$ docker start -i mean</code></pre>
<p>Make sure that MongoDB, NodeJS, and Angular is configured correctly by running the following commands:</p>
<pre class="term"><code>$ mongo -version
$ node --version
$ ng --version</code></pre>
<p>In writing the code for Project 4, you are likely to encounter bugs in your code and need to figure out what went wrong. <a href="https://developer.chrome.com/devtools">Chrome Developer Tools</a> is a very popular tool among web developers, which allows them to investigate the current state of any web application using an interactive UI. We strongly recommend it for Project 4 and make it part of your everyday tool set. There are many excellent online tutorials on Chrome Developer Tools such as <a href="https://developer.chrome.com/devtools">this one</a>.</p>
<h2 id="part-a-learn-angular-and-basic-concepts">Part A: Learn Angular and Basic Concepts</h2>
<p>Angular is a front-end web-development framework that makes it easy to build applications for the web. Angular combines <em>declarative templates</em>, <em>dependency injection</em>, <em>end-to-end tooling</em>, and integrates best development practices to solve challenges in web front-end development. Angular empowers developers to build applications that live on the web, mobile, or the desktop.</p>
<p>The latest Angular version uses <a href="https://www.typescriptlang.org/">TypeScript</a>, an extended version of JavaScript, as its primary language. Fortunately, most Angular code can be written with just the latest JavaScript, with a few additions like <a href="https://www.typescriptlang.org/docs/handbook/classes.html">types</a> for dependency injection, and <a href="https://www.typescriptlang.org/docs/handbook/decorators.html">decorators</a> for metadata. We go over essential TypeScript for Angular in class, and <a href="../slides/typescript.html">the class lecture slides</a> are available.</p>
<p>Angular official website provides an excellent introductory tutorial on Angular development: <a href="https://angular.io/tutorial">Tour of Heroes tutorial</a>. It introduces the fundamental concepts for Angular development by building a simple demo application. It may take some time to finish this tutorial, but we believe <strong>following this tutorial is still the most effective and time-saving way to get yourself familiar with the Angular development</strong>. Please go over the tutorial at least from <a href="https://angular.io/tutorial"><em>Introduction</em></a> through the <a href="https://angular.io/tutorial/toh-pt4"><em>Add Services</em></a> sections.</p>
<p>If you have previous Angular or similar web-framework development experience, you can choose to read the <a href="https://angular.io/guide/architecture">Angular documentation</a> directly instead. However, for most students who have not worked with Angular extensively before, reading the documentation may take more time than following the step-by-step tutorial. Thus, our recommendation is to start with the tutorial and then go over the documentation after you get familiar with the basics.</p>
<p>Note that when you follow the tutorial using the Angular CLI preinstalled in our container, you will need to use the following command to “run” your Angular code:</p>
<pre class="term"><code>$ ng serve --host 0.0.0.0</code></pre>
<p>not “<code>ng serve --open</code>” as described in the tutorial.</p>
<p><strong>Note on <code>--host</code> option:</strong> By default, Angular HTTP server binds to only “localhost”. This means that if any request comes from other than localhost, it does not get it. When Angular runs on the same machine as the browser, this is not a problem. Angular binds to localhost and the browser sends a request to localhost. But when Angular runs in a docker container, the localhost of Angular is different from the localhost of the browser. Angular sees localhost of <em>container</em> and browser sees the localhost of the <em>host</em>. By adding “<code>--host 0.0.0.0</code>”, we instruct Angular to bind to <em>all network interfaces</em> within the container, not just localhost, so that Angular is able to get and respond to a request forwarded by Docker through network forwarding.</p>
<p><strong>Notes on auto-rebuild:</strong> Some students report that <code>ng serve</code> does not auto-rebuild your app, particularly when your files are located somewhere below <code>~/shared/</code>. If that is the case, either move your files out of <code>~/shared/</code> to some other location or try “<code>ng serve --host 0.0.0.0 --poll=2000</code>”. The development server will look for file changes every two seconds and compile if necessary.</p>
<p><strong>Some caveats: Do not confuse Angular with AngularJS!</strong> AngularJS is an older version of the Angular framework and is no longer a recommended version. The difference between the “old” AngularJS and the “new” Angular is quite extensive, as you can read from <a href="https://medium.com/@angularminds/comparison-between-angular-1-vs-angular-2-vs-angular-4-62fe79c379e3">more detailed comparison articles</a> on the web. For our project, ignore previous AngularJS versions and just learn the new Angular CLI using the links and tutorials provided in this spec.</p>
<p>After you finish the tutorial, go over the following questions and make sure you can answer them by yourself.</p>
<ul>
<li>What is a Component in Angular?</li>
<li>What is a Template? What are Directives in a Template?</li>
<li>How does Angular support Data Binding?</li>
<li>What is a Service and how can Dependency Injection be used in Angular?</li>
<li>What are commonly used Angular CLI commands, such as generating a component or a service?</li>
</ul>
<p>Please read corresponding sections in <a href="https://angular.io/guide/architecture">the Angular documentation</a> for review if the answer to any question is not clear.</p>
<p>Now you have equipped yourself with enough Angular knowledge to get started with Project 4. Good Luck!</p>
<h2 id="part-b-project-demo-and-requirements">Part B: Project Demo and Requirements</h2>
<p>Project 4 is all about a front-end markdown blog editor and previewer. It should be implemented as a <a href="https://en.wikipedia.org/wiki/Single-page_application">single-page application (SPA)</a>, which means that your entire application runs on a “single page.” The website interacts with the user by dynamically updating only a part of the page rather than loading an entirely new page from the server. This approach avoids long waits between page navigation and sudden interruptions in the user interaction, making the application behave more like a traditional desktop application. A typical example of an SPA is <a href="https://gmail.com">Gmail</a>.</p>
<p>An important feature of a SPA is that <strong>a specific state of the application is associated with the corresponding URL</strong>, so that a user does not accidentally exit from the app by pressing the browser back button. When a user presses the back button, the user should go to the <em>previous state within the app</em> (unless the user just opened the app) as opposed to exiting from the app and go to the page visited before the app. As an example, open <a href="https://gmail.com">Gmail</a>, click on a few mail messages and/or folder labels, and then press the browser back button. You will see that you do not exit from the Gmail app, even though all your interaction in the app happened on a <em>single page</em> and, technically, the “previous page” in your visit history should be the page that you visited <em>before</em> you opened the Gmail app. In addition, if you cut and paste the Gmail’s drafts folder URL <a href="https://gmail.com/#drafts" class="uri">https://gmail.com/#drafts</a> into the browser address bar, you will see that you directly land on the draft folder of Gmail, not its generic start page.</p>
<p>Before we describe the detailed requirements for Project 4, we encourage you to visit our Project 4 demo website at <a href="http://oak.cs.ucla.edu/classes/cs144/project4/demo/" class="uri">http://oak.cs.ucla.edu/classes/cs144/project4/demo/</a>. It is rather simple, does not contain many CSS-styling instructions, does not actually store blog posts on the server, but it will help you understand the basic UI interactions to be implemented for Project 4.</p>
<div style="clear: both;">

</div>
<p><img src="edit.png" style="float: right; width: 300px;" /></p>
<p>Now here is more detailed spec for Project 4. In the first image on the right, we show the <strong>edit view</strong> of the application, which allows the user to edit a post. In this view, we require you to implement the following functionalities:</p>
<ul>
<li>The view shows two separate input box/textarea for the title and the body of a blog post with <code>id</code> attribute <code>edit-title</code> and <code>edit-body</code>, respectively.</li>
<li>The “last modified” date and time of the post is shown below the input areas.</li>
<li>The view should contain at least three buttons, “save”, “preview”, and “delete” with the <code>id</code> attribute <code>edit-save-button</code>, <code>edit-preview-button</code>, and <code>edit-delete-button</code>, respectively.</li>
<li>When the “save” button is pressed, the post should be permanently saved/updated in the server and be added to the “list pane” (described below) if it is a new post. The last-modified date of the post must be updated to the current time.</li>
<li>When the “preview” button is clicked, the app should switch to the “preview view” (see below).</li>
<li>When the “delete” button is clicked, the post should be permanently deleted from the server and disappear from the “list pane” (described below).</li>
</ul>
<div style="clear: both;">

</div>
<p><img src="preview.png" style="float: right; width: 300px;" /></p>
<p>In the second image, we show the <strong>preview view</strong> of the application. In this view, we require you to implement the following functionalities:</p>
<ul>
<li>The view shows an HTML-rendered preview of the current markdown post being edited by the user. In particular, the title and the body of the post should appear in an HTML elements whose <code>id</code> attributes are <code>preview-title</code> and <code>preview-body</code>, respectively.</li>
<li>There is an “edit” button with <code>id</code> attribute <code>preview-edit-button</code> that allows switching back to the edit view.</li>
</ul>
<div style="clear: both;">

</div>
<p><img src="list.png" style="float: right; width: 300px;" /></p>
<p>In the third image, we show the <strong>list pane</strong>, that should meet the following requirements:</p>
<ul>
<li>It shows the list of all blog posts that have been written by the user. Each blog post entry should appear in an HTML element whose <code>id</code> attribute is <code>list-post-:postid</code>, where <code>:postid</code> is the <code>postid</code> of the corresponding post.</li>
<li>The posts in the list should be sorted by their <code>postid</code> in the ascending order.</li>
<li>Each post in the list must show the title and the creation date of the post.</li>
<li>The user can start writing a new post anytime by clicking the “new post” button whose <code>id</code> attribute is <code>list-new-button</code>. Clicking the button should <strong>open the edit view of a new empty post on the right side.</strong></li>
<li>The user can edit any of existing post by clicking its entry in the list, which <strong>opens the edit view of the post on the right side.</strong></li>
</ul>
<p>Note that differently from Project 2, you are required to make the markdown editor as an SPA and <strong>the list pane should be always visible on the left side</strong>.</p>
<p>In addition, when the user presses the browser’s back button, the user should go to the “previous state” of the app, not to the page visited prior to your app. For example, If the user opened the app, clicked on the first post in the list pane, pressed the “preview” button, and clicks on the browser back button, the user should go to the “edit view” of the clicked post. In particular, you need to associate the three “states” of our app with the following URL patterns:</p>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 82%" />
</colgroup>
<thead>
<tr class="header">
<th>URL</th>
<th>state</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>/editor/#/</code></td>
<td>This default path shows only the list pane, without showing the edit or preview view</td>
</tr>
<tr class="even">
<td><code>/editor/#/edit/:id</code></td>
<td>This path shows the list pane and the “edit view” of the post with <code>postid=:id</code>. <code>:id=0</code> means the edit view for a “new post.”</td>
</tr>
<tr class="odd">
<td><code>/editor/#/preview/:id</code></td>
<td>This path shows the list pane and the “preview view” of the post with <code>postid=:id</code></td>
</tr>
</tbody>
</table>
<p>Note that blog posts stored in MongoDB of your Project 3 are updated/saved/deleted only when the user presses the “save” or “delete” button in the edit view. Also, the HTML rendering of a blog post displayed in the preview page should be generated by a JavaScript code running inside the browser, using the <a href="https://github.com/commonmark/commonmark.js">commonmark.js</a> library. In addition, <strong>if the user tries to access the Angular editor at the URL <code>/editor/</code> without authenticating themselves first, the request must be redirected to <code>/login?redirect=/editor/</code> with the status code 302, so that the user should authenticate themselves first and automatically come back to the editor.</strong> This will ensure that when the client-side Angular app is loaded in the browser, the browser has already obtained a valid JWT cookie, so that the JWT can be sent to the server when it tries to access the Blog-Management REST API implemented in Project 3. Implementing this redirection-for-authentication mechanism will require minor changes to the server-side code of Project 3.</p>
<p>Finally, if your code includes any URL to access various functionalities of your site, make sure that the <strong>URLs do not include the hostname portion</strong>, so that your code can be hosted on any domain without any change. For example, if you need send a request to <code>/api/posts</code>, use the URL <code>/api/posts</code> not <code>http://localhost:3000/api/posts</code>.</p>
<p>In the rest of the project spec, we describe more detailed guidance on how you can implement Project 4. However, keep it mind that <strong><em>the rest of our project description is a suggestion, not a requirement</em></strong>. As long as your code meets all requirements in Part B, you can implement your application however you want. We provide further description here in case you need more guidance and help to finish this project.</p>
<h2 id="part-c-create-project-skeleton-using-angular-cli">Part C: Create Project Skeleton using Angular CLI</h2>
<p>Now it is time to start working on the project using the Angular Command-Line Interface (CLI). First create a skeleton Angular application using the following command:</p>
<pre class="term"><code>$ ng new angular-blog
? Do you want to enforce stricter type checking and stricter bundle budgets in the workspace?
  This setting helps improve maintainability and catch bugs ahead of time.
  For more information, see https://angular.io/strict No
? Would you like to add Angular routing? No
? Which stylesheet format would you like to use? (Use arrow keys)
❯ CSS
  SCSS   [ https://sass-lang.com/documentation/syntax#scss                ]
  Sass   [ https://sass-lang.com/documentation/syntax#the-indented-syntax ]
  Less   [ http://lesscss.org                                             ]
  Stylus [ http://stylus-lang.com                                         ]</code></pre>
<p>Answer with <code>No</code> for the first two question and choose <code>CSS</code> for style sheet format. This may take a while since a lot of files are fetched and generated (≈ 500MB). When the skeleton code is created successfully, you will see the following output.</p>
<pre class="term"><code>Packages installed successfully.</code></pre>
<p>In case you encounter an error during the code generation, please see <a href="#project-directory">Notes on Project Directory</a>.</p>
<p>The <code>angular-blog</code> directory contains the initial skeleton code and looks like the following:</p>
<pre><code>angular-blog
 +- e2e
 +- src 
    +- app
        +- app.component.css
        +- app.component.html
        +- app.component.spec.ts
        +- app.component.ts
        +- app.module.ts
    +- assets
    +- environments
    +- index.html
    +- styles.css
    +- typings.d.ts
    +- ...
 +- package.json
 +- README.md
 +- ...</code></pre>
<p>This may look like a lot of files at the first glance, but don’t get overwhelmed. The files you need to touch are <em>all inside the <code>src/app</code> folder</em>. Other files can be ignored in most cases.</p>
<p><a name="project-directory"></a></p>
<p><strong>Notes on Project Directory:</strong> For Project 4, we strongly recommend developing your code outside of the shared directory, say at <code>~/project4/angular-blog/</code>, not within <code>~/shared/</code>. Students experienced a whole set of issues in the past when the project code was placed within the shared directory, starting from an error during the generation of the skeleton code (!). This setup, unfortunately, makes it a bit hard to use your favorite editor in your host machine to edit your code. A possible workaround could be to copy all your files in <code>~/project4/angular-blog/src/app/</code> into a shared folder, say <code>~/shared/project4</code>, by a command like:</p>
<pre class="term"><code>$ cp -r ~/project4/angular-blog/src/app/* ~/shared/project4/</code></pre>
<p>and use your host editor to edit the code in <code>~/shared/project4</code>. Once you are done with a batch of edits, you can then “synchronize” your main code in the container with your edits in the shared folder by copying back the edited files like:</p>
<pre class="term"><code>$ cp -r ~/shared/project4/* ~/project4/angular-blog/src/app/</code></pre>
<p>Since you will have to execute the above command many times during development, it may be a good idea to create an alias, like:</p>
<pre class="term"><code>$ alias ccc=&quot;cp -r ~/shared/project4/* ~/project4/angular-blog/src/app/&quot;</code></pre>
<p>so that you can simply type <code>ccc</code> to copy your edited files back to the main project directory.</p>
<h3 id="serving-and-accessing-generated-app">Serving and Accessing Generated App</h3>
<p>Once the skeleton code is generated, you can compile and serve the generated app using “ng serve”</p>
<pre class="term"><code>$ ng serve --host 0.0.0.0</code></pre>
<p>and access it with your browser at <a href="http://localhost:4200/" class="uri">http://localhost:4200/</a>. <strong>Do not forget <code>--host 0.0.0.0</code> as we are serving the Angular app from the container.</strong></p>
<p>When you launch and access the app, the page you see is the “application shell.” The shell is controlled by an Angular component named <code>AppComponent</code>.</p>
<p>Components are fundamental building blocks of any Angular application. They display data on the screen, listen for user input, and triggers an event based on that input. In the <code>src/app</code> folder, the Angular CLI has created the four files that are responsible for the <code>AppComponent</code>:</p>
<ul>
<li><code>app.component.ts</code>: the component class file, written in TypeScript.</li>
<li><code>app.component.html</code>: the component template, written in HTML.</li>
<li><code>app.component.css</code>: the component’s style, written in CSS.</li>
<li><code>app.component.spec.ts</code>: the “.spec.ts” file is used for unit testing, and you can ignore it for now.</li>
</ul>
<p>Refer to the <a href="https://angular.io/tutorial/toh-pt0#angular-components">Angular components</a> section of the tutorial if you are not sure how these files work together to form a component.</p>
<h2 id="part-d-implement-ui-components">Part D: Implement UI Components</h2>
<p>Roughly, our editor will be split into three components and one service:</p>
<ol type="1">
<li><p><em>List component</em>: This component is responsible for the UI interaction of the “list pane.” This component should be visible on the left side of the app all the time. The user should be able to click on a post in the list to edit it. It should also contain a “new post” button to start editing a new post.</p></li>
<li><p><em>Edit component</em>: This component is responsible for the UI interaction of the “edit view” of the app. When the user clicks on a post in the list pane, this component should be displayed on the right side of the list and let the user edit the title and body of the post. It should also contain buttons for “save,” “delete,” and “preview.”</p></li>
<li><p><em>Preview component</em>: This component is responsible for the UI interaction of the “preview view.” When the user clicks on the “preview” button in the edit component, this component should replace the edit component and show the HTML version of the post. This component also contains an “edit” button to let the user go back to the edit view.</p></li>
<li><p><em>Blog service</em>: This service provides the abstraction to the REST API to allow our app to access the Express MongoDB server implemented in Project 3.</p></li>
</ol>
<p>We will first start with implementing the three components responsible for the UI interaction, but before we do that, we need to define the <code>Post</code> class, which is the key data structure to model the user’s blog posts.</p>
<h3 id="add-post-class">Add <code>Post</code> class</h3>
<p>The <code>Post</code> class is the key data model representing a user’s blog post:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">export</span> <span class="kw">class</span> Post <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="dt">postid</span><span class="op">:</span> number <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="dt">created</span><span class="op">:</span> number <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="dt">modified</span><span class="op">:</span> number <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="dt">title</span><span class="op">:</span> string <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="dt">body</span><span class="op">:</span> string <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="op">};</span></span></code></pre></div>
<p>Note the <code>export</code> keyword since it will be imported and used by all components of our app. <code>postid</code> is the unique id of the blog post, <code>created</code> and <code>modified</code> are the post’s creation and last modification time represented as milliseconds since the UNIX epoch, and <code>title</code> and <code>body</code> are the actual content of the post in markdown.</p>
<p>Create the file <code>post.ts</code> in the <code>angular-blog/src/app</code> folder with the above content, so that it can be imported and used by the components that we will implement soon.</p>
<h3 id="implement-list-component">Implement List Component</h3>
<p>As the first basic UI element, we create the list component. First, generate its skeleton code using Angular CLI:</p>
<pre class="term"><code>$ ng generate component list
CREATE src/app/list/list.component.css (0 bytes)
CREATE src/app/list/list.component.html (19 bytes)
CREATE src/app/list/list.component.spec.ts (614 bytes)
CREATE src/app/list/list.component.ts (267 bytes)
UPDATE src/app/app.module.ts (540 bytes)</code></pre>
<p>Remember that the list component is responsible for three types of user interactions:</p>
<ol type="1">
<li>It displays all blog posts by the user.</li>
<li>It allows the user to “click” on a displayed post, so that they can start editing it.</li>
<li>It displays a “New Post” button, so that the user can start writing a new post.</li>
</ol>
<p>Note that components are “dumb” UI elements that do not know or care the high-level semantics of the app. They simply display what they are asked to display and notify others of any events triggered by the user actions on them.</p>
<p>Given the three user interactions described above, we see that iteraction 1 requires the list component to be able to “take an input” from “outside” to get “posts to display.” Interactions 2 and 3 require the list component to be able to “trigger events” and notify others that a user action has been taken. To support these three interactions, <code>ListComponent</code> will have one “input property”, named <code>posts</code>, and two “output events”, named <code>openPost</code> and <code>newPost</code>. That is, anyone should be able to create and use <code>ListComponent</code> by adding the following directive in the template:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">&lt;app-list</span><span class="ot"> [posts]=</span><span class="st">&quot;postsToDisplay&quot;</span> </span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="ot">          (openPost)=</span><span class="st">&quot;openPostHandler($event);&quot;</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="ot">          (newPost)=</span><span class="st">&quot;newPostHandler();&quot;</span><span class="kw">&gt;&lt;/app-list&gt;</span></span></code></pre></div>
<p>Note that there are three data bindings inside the <code>&lt;app-list&gt;</code> directive, one input property binding and two output event bindings. In the above directive, <code>ListComponent</code> takes <code>postsToDisplay</code> (whose type should be <code>Post[]</code>) as an “input”, which is bound to its <code>posts</code> property. In addition, the directive will call <code>openPostHandler($event)</code> and <code>newPostHandler()</code> functions when <code>openPost</code> and <code>newPost</code> events are triggered by <code>ListComponent</code>, respectively. The <code>$event</code> object passed from the <code>openPost</code> event should be a <code>Post</code> object representing the post clicked by the user. The <code>newPost</code> event does not pass any event object. If our description here sounds cryptic, please go over <a href="http://oak.cs.ucla.edu/classes/cs144/notes/angular.html">class notes on Angular</a> and Angular documentation on <a href="https://angular.io/guide/template-syntax#property-binding-property"><em>property binding</em></a> and <a href="https://angular.io/guide/template-syntax#event-binding-event"><em>event binding</em></a>.</p>
<p>Now, add the three properties — <code>posts</code>, <code>openPost</code> and <code>newPost</code> — to the <code>ListComponent</code> class to support the above property and event bindings. The following information will be helpful in adding the properties:</p>
<ol type="1">
<li><p>To use the <code>Post</code> class, you will have to import it in <code>list.component.ts</code> like the following:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb14-1"><a href="#cb14-1"></a><span class="im">import</span> <span class="op">{</span> Post <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../post&#39;</span><span class="op">;</span></span></code></pre></div></li>
<li><p>To allow property binding to a component class property, you need decorate the property with <a href="https://angular.io/api/core/Input">@Input()</a>. Import the decorator to use it in your code:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb15-1"><a href="#cb15-1"></a><span class="im">import</span> <span class="op">{</span> Input <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;@angular/core&#39;</span><span class="op">;</span></span></code></pre></div></li>
<li><p>To trigger a custom event from a property, you need to decorate it with <a href="https://angular.io/api/core/Output">@Output()</a> and create and assign a <a href="https://angular.io/api/core/EventEmitter">EventEmitter</a>. Once created, you can simply call <a href="https://angular.io/api/core/EventEmitter#emit">emit(obj)</a> on such a property to trigger a custom event with the property’s name and pass <code>obj</code> as the <code>$event</code> object. Import <code>@Output</code> decorator and <code>EventEmitter</code> class to use them in your code:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb16-1"><a href="#cb16-1"></a><span class="im">import</span> <span class="op">{</span> Output<span class="op">,</span> <span class="bu">EventEmitter</span> <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;@angular/core&#39;</span><span class="op">;</span></span></code></pre></div></li>
</ol>
<p>If you are not clear about how to use <a href="https://angular.io/api/core/Input">@Input()</a>, <a href="https://angular.io/api/core/Output">@Output()</a> and <a href="https://angular.io/api/core/EventEmitter">EventEmitter</a>, please go over the linked Angular documentation.</p>
<p>Once you finish adding the three properties to the component class, update your component template file <code>list.component.html</code>. Remove the auto-generated HTML code and add appropriate HTML elements and event bindings to display <code>posts</code> as a list and to trigger <code>openPost</code> and <code>newPost</code> events given corresponding user actions. In modifying the template, you may find the following information useful:</p>
<ul>
<li>You may find the <a href="https://angular.io/guide/template-syntax#built-in-structural-directives"><em>structural directives</em></a> helpful in displaying the list of posts.</li>
<li>You can use <a href="https://angular.io/guide/template-syntax#interpolation-"><em>interpolation</em></a> (e.g., <code>{{post.title}}</code>) if you want to display data in a component class property in the template.</li>
<li>You can use <a href="https://angular.io/guide/template-syntax#event-binding"><em>event binding</em></a> (e.g., <code>(click)="delete();"</code>), to call a component class method in your template when an event triggered on an HTML element.</li>
<li>You can create a JavaScript <code>Date</code> object from <code>post.created</code> like <code>new Date(post.created)</code>. This may be helpful in converting the time to a string representation.</li>
</ul>
<p>Once you finish modifying the template and the component class, thoroughly test its functionality by adding it as a child component of <code>AppComponent</code>. Pass a list of “fake” posts to <code>ListComponent</code> through property binding and take “fake” actions (like printing a message in Chrome Developer Console) when the custom events are triggered to ensure that <code>ListComponent</code> behaves as expected.</p>
<p>Add CSS rules to <code>list.component.css</code> to make the component look reasonable.</p>
<p><strong>Notes on Testing on Angular Development Server</strong>:</p>
<ol type="1">
<li><p>Again, you can compile and serve the Angular app through “<code>ng serve --host 0.0.0.0</code>” command and access it from your browser at <a href="http://localhost:4200/" class="uri">http://localhost:4200/</a>. If your <code>ng serve</code> does not auto-rebuild, try “<code>ng serve --host 0.0.0.0 --poll=2000</code>”.</p></li>
<li><p>Due to an unknown reason, <code>ng serve</code> sometimes behaves unexpectedly and throws errors when it shouldn’t. When this happens, stopping and restarting <code>ng serve</code> seems to fix the problem.</p></li>
<li><p>Note that under <code>ng serve</code> your “Angular editor app” is accessible at <a href="http://localhost:4200/" class="uri">http://localhost:4200/</a> not at <a href="http://localhost:4200/editor/" class="uri">http://localhost:4200/editor/</a> as required in Part B. You don’t need to worry about this for now. When you build your final app in Part H, you will add the option <code>--deploy-url=/editor/ --base-href=/editor/</code> to make your app available at <code>/editor/</code>.</p></li>
</ol>
<p><strong>Notes on Unit Testing</strong>:</p>
<p>Whenever you update your code, you may want to test the functionality of individual part to ensure that your change does not break anything. To help developers “unit test” their code, Angular has integrated two excellent tools, <em>Jasmine</em> and <em>Karma</em>. While learning them is not necessary for this project, this <a href="https://codecraft.tv/courses/angular/unit-testing/overview/">excellent tutorial on unit testing on Angular</a> explains how to use these tools. It will take a few hours to go through, but you will be well rewarded especially if you decide to be a serious Angular developer. Unfortunately, to reduce its footprint, our container does not have the web browser necessary for unit testing Angular components. If you want to test out Jasmine and Karma as you follow along the tutorial, you will need to install Angular on your host machine yourself and use that version, not the one in our container.</p>
<h3 id="implement-edit-component">Implement Edit Component</h3>
<p>Now let us create the second component, the edit component:</p>
<pre class="term"><code>$ ng generate component edit</code></pre>
<p>Recall that <code>EditComponent</code> is used to support the following user interactions:</p>
<ol type="1">
<li>The user should be able to edit the title and body of the post.</li>
<li>When the user clicks on the “save” button, the post should be updated/saved at the server.</li>
<li>When the user clicks on the “delete” button, the post should be deleted from the server and the displayed list.</li>
<li>When the user clicks on the “preview” button, the “preview view” should open.</li>
</ol>
<p>Item 1 requires “taking an input” from outside, since the component has to obtain the current content of the post to edit. Items 2 through 4 require “notifying user actions” to outside of the component. Thus, <code>EditComponent</code> will have one input property <code>post</code> and three output events, <code>savePost</code>, <code>deletePost</code> and <code>previewPost</code>. That is, the component may be used with the following directive:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">&lt;app-edit</span><span class="ot"> [post]=</span><span class="st">&quot;postToEdit&quot;</span> </span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="ot">          (savePost)=</span><span class="st">&quot;savePostHandler($event);&quot;</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="ot">          (deletePost)=</span><span class="st">&quot;deletePostHandler($event);&quot;</span> </span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="ot">          (previewPost)=</span><span class="st">&quot;previewPostHandler($event);&quot;</span><span class="kw">&gt;&lt;/app-edit&gt;</span></span></code></pre></div>
<p>The <code>post</code> input property binds to a <code>Post</code> value/variable. The three output events pass the <code>Post</code> object (the post that has been edited by the user) as the <code>$event</code> object.</p>
<p>Add the four properties — <code>post</code>, <code>savePost</code>, <code>deletePost</code> and <code>previewPost</code> — to the <code>EditComponent</code> class to support the above property and event bindings. Once you finish adding the four properties, update your component template file to support the UI interaction.</p>
<!-- In modifying the template, you may find the following information useful:
-   Data can be dynamically exchanged between a template element and a component property through Angular's [*two-way binding*](https://angular.io/guide/template-syntax#two-way-binding---) using the [ngModel directive](https://angular.io/guide/template-syntax#ngmodel-two-way-binding) like `[(ngModel)]="post.title"`. This mechanism can be used, for example, to support displaying and editing the post's title in a text input box. Note that if you want to use the `ngModel` directive in your template, [`FormsModule`](https://angular.io/tutorial/toh-pt1#import-formsmodule) needs to be imported from `@angular/forms` in the `app.module.ts` file and listed in the `imports` property of the `@NgModule` decorator.
-   You can use the [*structural directive* `*ngIf`](https://angular.io/guide/template-syntax#ngif) or the [*safe navigation operator* `?.`](https://angular.io/guide/template-syntax#safe-navigation-operator) to guard against `null` or `undefined` values in a property.
-->
<p>Once you finish modifying the template and component class, thoroughly test its functionality by adding it as a child component of <code>AppComponent</code>.</p>
<p>Add CSS rules to <code>edit.component.css</code> to make the component look reasonable.</p>
<h3 id="implement-preview-component">Implement Preview Component</h3>
<p>The <code>PreviewComponent</code> renders a post in HTML. It also has an “edit” button to let the user go back to the “edit view.” Thus, the <code>PreviewComponent</code> will have one input property and one output event and can be used with a directive like the following:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">&lt;app-preview</span><span class="ot"> [post]=</span><span class="st">&quot;postToDisplay&quot;</span> </span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="ot">             (editPost)=</span><span class="st">&quot;editPostHandler($event);&quot;</span><span class="kw">&gt;&lt;/app-preview&gt;</span> </span></code></pre></div>
<p>Here, <code>postToDisplay</code> is a <code>Post</code> object to be displayed by the component and the <code>editPost</code> event passes the displayed <code>Post</code> object as the <code>$event</code> object. Create the preview component through the Angular CLI, modify its component class, template, and CSS files to support the above usage.</p>
<p>For markdown to HTML rendering, we will use <a href="https://github.com/commonmark/commonmark.js">commonmark.js library</a>. Install the <code>commonmark</code> module through the following commands:</p>
<pre class="term"><code>$ npm install commonmark
$ npm install @types/commonmark</code></pre>
<p>The second command installs the type definition file used by the TypeScript compiler. Once installed, you can use its <code>Parser</code> and <code>HtmlRenderer</code> by including the following import statement:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb21-1"><a href="#cb21-1"></a><span class="im">import</span> <span class="op">{</span> Parser<span class="op">,</span> HtmlRenderer <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;commonmark&#39;</span><span class="op">;</span></span></code></pre></div>
<p>After you finish developing <code>PreviewComponent</code>, test it thoroughly by including it in the <code>AppComponent</code> template and binding to fake posts and event handlers.</p>
<p>Congratulations! You have successfully finished implementing all basic UI elements of our app.</p>
<h2 id="part-e-connect-the-dots">Part E: Connect the Dots</h2>
<p>Now that we have basic UI elements ready, let us “connect” them to support the user interaction described in Part B. At a high level, this step requires two things:</p>
<ol type="1">
<li><strong>Maintaining application states</strong>: Any running app needs to maintain “local states” to represent the user data and keep track of the exact state of the app after many user interactions. Roughly our app needs to maintain three key states:
<ol type="1">
<li><em>User’s post list</em> (<code>posts: Post[]</code>): The app has to keep track of the user’s blog posts, so that the list component can display them and let users click on them.</li>
<li><em>The current post being edited/previewed</em> (<code>currentPost: Post</code>): The app also has to keep track of the current post being edited/previewed and hold any unsaved edits made by the user before they are permanently saved in the server.</li>
<li><em>The current state of the app</em> (<code>appState: enum { List, Edit, Preview }</code>): At any point of the time, the app is in one of three states: (1) <code>List</code>: In this state, the app only displays the list component on the left (2) <code>Edit</code>: In this state, the app displays the list component on the left and the edit component on the right (3) <code>Preview</code>: In this state, the app displays the list component on the left and the preview component on the right.</li>
</ol></li>
<li><strong>Connecting events to actions</strong>: As the app goes through its lifecycle via user-driven “events,” it has to populate and update the above states to reflect what has happened so far. Roughly, the following events are critical milestones in the app’s lifecycle that lead to significant changes in its states.
<ol type="1">
<li><em>Initialization</em>: When the app is loaded, the app has to obtain the user’s blog posts from the server to populate <code>posts</code> and pass them to the list component. The app always starts in the <code>List</code> state (i.e., <code>appState = List</code>).</li>
<li><em>Clicking on a post</em>: When the user clicks one of the posts in the list, the app should set <code>currentPost</code> to the clicked post. The <code>appState</code> changes to <code>Edit</code>.</li>
<li><em>Clicking on the new button</em>: When the user clicks on the “new post” button, the app should set <code>currentPost</code> to a new empty post. The <code>appState</code> changes to <code>Edit</code>.</li>
<li><em>Editing the current post</em>: As the user edits the title and the body of the current post, the content of <code>currentPost</code> should be updated.</li>
<li><em>Clicking the save button</em>: When the user clicks on the save button, changes in <code>currentPost</code> should be saved in the server and updated in local <code>posts</code> list.</li>
<li><em>Clicking the delete button</em>: When the user clicks on the delete button, the current post should be deleted both from the MongoDB server and the local <code>posts</code> list. The <code>appState</code> changes to <code>List</code>.</li>
<li><em>Clicking the preview and edit buttons</em>: When the user clicks on the preview button in the edit component or the edit button in the preview component, <code>appState</code> changes between <code>Edit</code> and <code>Preview</code>.</li>
</ol></li>
</ol>
<p>In our implementation, we will make the <code>AppComponent</code>, the root component of our app, be responsible for maintaining the key states of our app and taking the appropriate actions when key events are triggered. Before we explain how, we need to briefly talk about <code>BlogService</code>.</p>
<h3 id="fake-blogservice">Fake <code>BlogService</code></h3>
<p>The primary role of <code>BlogService</code> is to allow our Angular app to retrieve, update, and save blog posts at a remote server via the REST API implemented in Project 3. Now create the <code>BlogService</code> skeleton code using the following command:</p>
<pre class="term"><code>$ ng generate service blog
  create src/app/blog.service.spec.ts (362 bytes)
  create src/app/blog.service.ts (110 bytes)</code></pre>
<p>Later in Part F, you will implement the real <code>BlogService</code> to integrate our app with the back-end server. In the meantime, to help you continue developing the app without worrying about all complex issues arising from the back-end server integration, we provide a <a href="./blog.service.ts">blog.service.ts</a> file that implements a “fake” <code>BlogService</code> that behaves almost like a real <code>BlogService</code>, but in reality does everything locally within the browser (using <code>localStorage</code>). You don’t have to worry about understanding the provided code. It is just a temporary patch to help you continue development. Simply <a href="./blog.service.ts">download the file</a> and replace the generated <code>src/app/blog.service.ts</code> with it.</p>
<p>The key functions that <code>BlogService</code> provides are the following:</p>
<ol type="1">
<li><p><code>fetchPosts(username: string): Promise&lt;Post[]&gt;</code> – This method returns a promise that is resolved to all blog posts by the user. If successful, the returned promise resolves to a <code>Post</code> array (of <code>Post[]</code> type) that contains the user’s posts. In case of an error, the promise is rejected to <code>Error(response.status)</code>.</p></li>
<li><p><code>getPost(username: string, postid: number): Promise&lt;Post&gt;</code> – This method returns a promise that is resolved to the retrieved post. In case of an error, the promise is rejected to <code>Error(response.status)</code>.</p></li>
<li><p><code>setPost(username: string, post: Post): Promise&lt;Post&gt;</code> – This method either inserts a new post (if <code>post.postid=0</code>) or updates an existing one (if <code>post.postid&gt;0</code>). If successful, the returned promise is resolved to a <code>Post</code> whose <code>modified</code> field has the value returned from the server (and <code>postid</code> and <code>created</code> fields as well in case of insertion). In case of an error, the promise is rejected to <code>Error(response.status)</code>.</p></li>
<li><p><code>deletePost(username: string, postid: number): Promise&lt;void&gt;</code> – This method deletes the corresponding blog post. In case of an error, the promise is rejected to <code>Error(response.status)</code>.</p></li>
</ol>
<h3 id="implement-appcomponent">Implement <code>AppComponent</code></h3>
<p>We now add the local states and the appropriate event handlers to <code>app.component.ts</code> and connect them to the three components that we implemented in Part D and the fake <code>BlogService</code> that we just downloaded.</p>
<p>As an initial set up, do the following to <code>app.component.ts</code>:</p>
<ol type="1">
<li><p>Add the necessary import statements to use <code>Post</code> class and <code>BlogService</code> classes</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb23-1"><a href="#cb23-1"></a><span class="im">import</span> <span class="op">{</span> Post <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./post&#39;</span><span class="op">;</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="im">import</span> <span class="op">{</span> BlogService <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./blog.service&#39;</span><span class="op">;</span></span></code></pre></div></li>
<li><p>Create an <a href="https://www.typescriptlang.org/docs/handbook/enums.html">enumeration type</a> <code>AppState</code>, so that we can use it as the type for the <code>appState</code> property that we will add soon:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">enum</span> AppState <span class="op">{</span> List<span class="op">,</span> Edit<span class="op">,</span> Preview <span class="op">};</span></span></code></pre></div></li>
<li><p>Make <code>BlogService</code> available in <code>AppComponent</code> through dependency injection by modifying its constructor signature:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">class</span> AppComponent <span class="op">{</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>    <span class="op">...</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>    <span class="kw">constructor</span>(<span class="kw">private</span> blogService<span class="op">:</span> BlogService) <span class="op">{}</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>    <span class="op">...</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="op">}</span></span></code></pre></div>
<p>If this sounds confusing, go over the the <a href="https://angular.io/tutorial/toh-pt4">services</a> section of <a href="https://angular.io/tutorial">Angular tutorial</a> again. The Angular documentation on <a href="https://angular.io/guide/dependency-injection">dependency injection</a> can also be helpful.</p></li>
</ol>
<p>Now that the basic preparation is done, add the following three properties and six event handlers to <code>AppComponent</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">class</span> AppComponent <span class="op">{</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>    <span class="op">...</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>    posts<span class="op">:</span> Post<span class="op">[];</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>    currentPost<span class="op">:</span> Post<span class="op">;</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>    appState<span class="op">:</span> AppState<span class="op">;</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>    <span class="op">...</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>    <span class="co">// event handlers for list component events</span></span>
<span id="cb26-8"><a href="#cb26-8"></a>    <span class="fu">openPost</span>(post<span class="op">:</span> Post) <span class="op">{}</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>    <span class="fu">newPost</span>() <span class="op">{}</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>    <span class="co">// event handlers for edit component events</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>    <span class="fu">previewPost</span>(post<span class="op">:</span> Post) <span class="op">{}</span></span>
<span id="cb26-12"><a href="#cb26-12"></a>    <span class="fu">savePost</span>(post<span class="op">:</span> Post) <span class="op">{}</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>    <span class="fu">deletePost</span>(post<span class="op">:</span> Post) <span class="op">{}</span></span>
<span id="cb26-14"><a href="#cb26-14"></a>    <span class="co">// event handlers for preview component events</span></span>
<span id="cb26-15"><a href="#cb26-15"></a>    <span class="fu">editPost</span>(post<span class="op">:</span> Post) <span class="op">{}</span></span>
<span id="cb26-16"><a href="#cb26-16"></a>    <span class="op">...</span></span>
<span id="cb26-17"><a href="#cb26-17"></a><span class="op">}</span></span></code></pre></div>
<p>Hopefully, the meaning of the above properties and methods are clear from our earlier discussion. Bind the above states and event handlers to the appropriate properties and events of the three child components of <code>AppComponent</code> by replacing the content of <code>app.component.html</code> with the following:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">&lt;app-list</span><span class="ot"> [posts]=</span><span class="st">&quot;posts&quot;</span> </span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="ot">          (openPost)=</span><span class="st">&quot;openPost($event);&quot;</span> </span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="ot">          (newPost)=</span><span class="st">&quot;newPost();&quot;</span><span class="kw">&gt;&lt;/app-list&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="kw">&lt;app-edit</span><span class="ot"> [post]=</span><span class="st">&quot;currentPost&quot;</span> </span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="ot">          (previewPost)=</span><span class="st">&quot;previewPost($event);&quot;</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="ot">          (savePost)=</span><span class="st">&quot;savePost($event);&quot;</span> </span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="ot">          (deletePost)=</span><span class="st">&quot;deletePost($event);&quot;</span><span class="kw">&gt;&lt;/app-edit&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="kw">&lt;app-preview</span><span class="ot"> [post]=</span><span class="st">&quot;currentPost&quot;</span> </span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="ot">             (editPost)=</span><span class="st">&quot;editPost($event);&quot;</span><span class="kw">&gt;&lt;/app-preview&gt;</span></span></code></pre></div>
<p>Add the structural directive to each child component as needed, so that only relevant components are displayed in a particular app state. For example, the edit component should appear only if <code>appState == AppState.Edit</code>. Keep in mind that the <code>enum AppState</code> type is not directly useable in the template, so you may want to add simple helper functions in the component class that compares the current <code>appState</code> against a particular value and call this helper function from your template.</p>
<p>Now write the code for the (currently empty) event handlers to implement the actions and state transitions that we discussed earlier. For this implementation, you may find the following information helpful:</p>
<ol type="1">
<li><p>When the application starts, it has to obtain the list of the user’s list of blog posts from the server. This can be done by calling <code>fetchPosts()</code> of <code>BlogService</code> either in the <code>AppComponent</code> constructor or in its <code>ngOnInit()</code> lifecycle hook. We recommend using the constructor, just because you have to add <code>import { OnInit } from '@angular/core';</code> statement and add <code>implements OnInit</code> to the <code>AppComponent</code> definition in order to add <code>ngOnInit()</code>. (Differently from other components, this is not automatically done to <code>AppComponent</code> by Angular CLI.)</p></li>
<li><p>Our fake <code>BlogService</code> completely ignores passed <code>username</code> and returns the same set of posts for any <code>username</code>. You will need to fix this behavior later in Part F, but it is good enough for now. When you call any method of <code>BlogService</code>, you can use any username, like <code>cs144</code>, for now.</p></li>
<li><p>The <code>openPost()</code> and <code>newPost()</code> event handlers should set <code>currentPost</code> to an appropriate post. In case of <code>newPost()</code>, you will have to create a new empty <code>Post</code> with <code>postid=0</code>. Recall that our REST API (and the <code>setPost()</code> method of <code>BlogService</code> in turn) saves a post as a <em>new</em> entry when <code>postid=0</code>.</p></li>
<li><p>The <code>savePost()</code> and <code>deletePost()</code> event handlers must ensure that the changes are reflected in the local state <code>posts</code> array as well. Remember that the new <code>postid</code>, <code>modified</code> and <code>created</code> values of the saved/updated post can be obtained from the resolved value of the promise returned from the <code>BlogService</code> function call.</p></li>
<li><p>If you are not sure how to use the <code>Promise</code> returned by <code>BlogService</code> methods, go over class slides on <a href="../slides/spa.html">SPA</a>, in particular, the slides on Fetch API.</p></li>
</ol>
<!--
6.  In some cases, the `post` parameter passed to our event handlers may not be needed by the handler. We just pass them whenever the custom event passes it as an `$event` object for the sake of completeness.
-->
<p>Implement all event handlers and make sure that they all work correctly together and support the user interactions described in Part B.</p>
<p>Once you thoroughly test your implementation for this part, add CSS rules to <code>app.component.css</code> and extra HTML elements to <code>app.component.html</code>, so that your app looks reasonable in every state.</p>
<h2 id="part-f-integrate-with-the-back-end-server">Part F: Integrate with the Back-End Server</h2>
<p>Now that you have an app that works well locally, it is time to integrate it with the back-end server from Project 3.</p>
<h3 id="running-two-servers">Running Two Servers</h3>
<p>To connect your angular app with the back-end server, you now need to run your Express server from Project 3. Eventually, your Angular app will be deployed to your Express server as well, so both your Express back-end and your Angular front-end will be served by a single server. But during development, you may want to serve your Angular app separately through the “ng serve” command, so that you can test, revise, and iterate quickly. Unfortunately, serving Angular app through a separate <code>ng serve</code> server has a few unintended consequences:</p>
<ol type="1">
<li><p>You have to run two servers – the Express server from Project 3 and the Angular app server through <code>ng serve --host 0.0.0.0</code> – in the same container. Running two servers simultaneously can be done by executing them <em>in the background</em> like the following:</p>
<pre class="term"><code>// change to your Project 3 directory
$ npm start &amp;
// change to your Project 4 directory
$ ng serve --host 0.0.0.0 &amp;</code></pre>
<p>Note the ampersands at the end, which execute the commands in the background. If you are not familiar with the Unix process control and job management, read the <a href="http://oak.cs.ucla.edu/classes/cs144/unix/unix5.html">Process section of our Unix tutorial</a>.</p></li>
<li><p>Your Angular app is loaded from <a href="http://localhost:4200" class="uri">http://localhost:4200</a> but your Express server runs at <a href="http://localhost:3000" class="uri">http://localhost:3000</a>. Because your browser will consider <code>localhost:4200</code> and <code>localhost:3000</code> as two completely different web sites, if your Angular app sends an HTTP request to <code>localhost:3000</code> it will be considered as a cross-origin request. This creates nasty CORS problems, which will not be an issue later after you deploy your Angular app to the Express server, but is an issue during development. To get around this problem, you need to set up an Angular CLI proxy, so that your app can send requests not to <code>localhost:3000</code> but to <code>localhost:4200</code> from which the app is loaded. To learn how, read our <a href="angular-proxy.html">Angular CLI proxy setup tutorial</a>.</p></li>
</ol>
<h3 id="obtain-username-from-jwt-cookie">Obtain Username from JWT Cookie</h3>
<p>Eventually when we deploy our Angular app to the Express server in Parts H and I, we will implement the code to ensure that the user is authenticated before they can access the Angular app. Unfortunately, this is not the case for now. You need to <strong><em>manually</em></strong> visit the page <a href="http://localhost:4200/login" class="uri">http://localhost:4200/login</a> with your browser and authenticate yourself to obtain a valid JWT cookie from the server. Note that JWT cookie is necessary for your app to communicate with the Express server through the REST API successfully. Otherwise, your Express server will reject any API request. So please visit <a href="http://localhost:4200/login" class="uri">http://localhost:4200/login</a> and authenticate yourself as one of the two existing users now before your forget. And remember to do it again whenever you restart your browser.</p>
<p>The <code>BlogService</code> API requires the authenticated user’s name as an input parameter, which can be obtained from the payload of the JWT cookie. To parse cookie values, first install the <a href="https://www.npmjs.com/package/cookie">cookie module</a>:</p>
<pre class="term"><code>$ npm install cookie
$ npm install @types/cookie</code></pre>
<p>and add the following import statement to <code>app.component.ts</code></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb30-1"><a href="#cb30-1"></a><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> cookie <span class="im">from</span> <span class="st">&#39;cookie&#39;</span><span class="op">;</span></span></code></pre></div>
<p>The browser’s cookie values are accessible at <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie">document.cookie</a>. You can use the function <code>cookie.parse()</code> to parse <code>document.cookie</code> into cookie name value pairs:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">let</span> cookies <span class="op">=</span> <span class="va">cookie</span>.<span class="at">parse</span>(<span class="va">document</span>.<span class="at">cookie</span>)<span class="op">;</span></span></code></pre></div>
<p>Go over the <a href="https://www.npmjs.com/package/cookie">cookie module documentation</a> to learn the detail.</p>
<p>Once you obtain the JWT token from the cookie, you may use a code similar to the following to convert its payload to a JSON object:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">function</span> <span class="at">parseJWT</span>(token) </span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="op">{</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>    <span class="kw">let</span> base64Url <span class="op">=</span> <span class="va">token</span>.<span class="at">split</span>(<span class="st">&#39;.&#39;</span>)[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>    <span class="kw">let</span> base64 <span class="op">=</span> <span class="va">base64Url</span>.<span class="at">replace</span>(<span class="ss">/-/g</span><span class="op">,</span> <span class="st">&#39;+&#39;</span>).<span class="at">replace</span>(<span class="ss">/_/g</span><span class="op">,</span> <span class="st">&#39;/&#39;</span>)<span class="op">;</span></span>
<span id="cb32-5"><a href="#cb32-5"></a>    <span class="cf">return</span> <span class="va">JSON</span>.<span class="at">parse</span>(<span class="at">atob</span>(base64))<span class="op">;</span></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="op">}</span></span></code></pre></div>
<p>Recall that the authenticated username appears in the <code>usr</code> field of the JWT payload. Modify the code in <code>app.component.ts</code> so that (1) the proper username from JWT is obtained and (2) the obtained username is used whenever a <code>BlogService</code> method is called.</p>
<h3 id="implement-new-blogservice">Implement New <code>BlogService</code></h3>
<p>Now remove the existing code in the <code>BlogService</code> class and reimplement it so that it actually communicates with the real Express server. The class should provide the following four key methods:</p>
<ol type="1">
<li><p><code>fetchPosts(username: string): Promise&lt;Post[]&gt;</code> – This method sends an HTTP GET request to <code>/api/posts?username=:username</code> and retrieves all blog posts by the user. If successful, the returned promise resolves to a <code>Post</code> array (of <code>Post[]</code> type) that contains the user’s posts. In case of an error, the promise is rejected to an <code>Error</code> object <code>new Error(String(response.status))</code>.</p></li>
<li><p><code>getPost(username: string, postid: number): Promise&lt;Post&gt;</code> – This method sends an HTTP GET request to <code>/api/posts?username=:username&amp;postid=:postid</code> and retrieves the post. If successful, the returned promise resolves to a <code>Post</code> that corresponds to the retrieved post. In case of an error, the promise is rejected to <code>Error(String(response.status))</code>.</p></li>
<li><p><code>setPost(username: string, post: Post): Promise&lt;Post&gt;</code> – This method sends an HTTP POST request to <code>/api/posts</code> with the corresponding JSON body, so that the server either inserts a new post (when <code>post.postid=0</code>) or updates an existing one (when <code>post.postid&gt;0</code>). If successful, the returned promise resolves to a <code>Post</code> whose <code>modified</code> field (and <code>postid</code> and <code>created</code> fields in case of insertion) has the value returned by the server. In case of an error, the promise is rejected to <code>Error(String(response.status))</code>.</p></li>
<li><p><code>deletePost(username: string, postid: number): Promise&lt;void&gt;</code> – This method sends an HTTP DELETE request to <code>/api/posts?username=:username&amp;postid=:postid</code> to delete the post from the server. In case of an error, the promise is rejected to <code>Error(String(response.status))</code>.</p></li>
</ol>
<p><strong>Notes</strong></p>
<ol type="1">
<li><p>The HTTP request to the server can be sent through various mechanisms, such as <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">Fetch</a> or <a href="https://angular.io/guide/http">HttpClient object</a> in Angular. We recommend Fetch, but the decision is up to you.</p></li>
<li><p>If you are not sure how to return a promise that will resolve to <code>Post[]</code> or <code>Post</code>, go over the <a href="../notes/promise.html">class notes on Asynchronous Programming</a>, in particular the slides on promise.</p></li>
<li><p>Make sure that the <strong><em>URLs in your API requests do not include hostname</em></strong>, so that your code can be hosted on any domain without any change. For example, you need to send a request to <code>/api/cs144/1</code>, not to <code>http://localhost:4200/api/cs144/1</code>.</p></li>
<li><p>Since the JWT token is set as a cookie, the browser will include it automatically in every REST API request to the server. Just make sure that you manually authenticate yourself with the browser first to obtain a valid JWT cookie from the server.</p></li>
</ol>
<p>Before you move on, make sure that your Angular app and Express server work well together without any problem.</p>
<h2 id="part-g-associate-states-with-url">Part G: Associate States with URL</h2>
<p>As we mentioned earlier, an important feature of a single-page application is that a specific state of the application is associated with the corresponding URL. Remember that a change in the <em>fragment identifier</em> (or fragment id) of the URL is handled entirely by the browser. That is, when the current URL’s fragment id changes, the browser does <strong><em>not</em></strong> reload the page from the server. Instead, the change is handled locally by the browser itself. This makes the fragment id the best place to encode the state of an SPA and support deep links and a good back-button behavior. In our project, we associate the three “states” of our app with the following fragment-id patterns:</p>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 82%" />
</colgroup>
<thead>
<tr class="header">
<th>URL</th>
<th>state</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>#/</code></td>
<td>This default path corresponds to the state <code>AppSate.List</code> and shows only the list pane, without showing the edit or preview view</td>
</tr>
<tr class="even">
<td><code>#/edit/:id</code></td>
<td>This path corresponds to the state <code>AppState.Edit</code> and shows the list pane and the “edit view” for the post with <code>postid=id</code></td>
</tr>
<tr class="odd">
<td><code>#/preview/:id</code></td>
<td>This path corresponds to the state <code>AppState.Preview</code> and shows the list pane and the “preview view” of the post with <code>postid=id</code></td>
</tr>
</tbody>
</table>
<p>To implement this association, we use the <code>window.location.hash</code> property and the <code>hashchange</code> event:</p>
<ol type="1">
<li>The <code>window.location.hash</code> property contains the fragment id portion of the current page’s URL. Whenever <code>window.location.hash</code> is set to a new value programmatically, a “new” URL with the given fragment id is appended to the browsing history and the browser “moves to” the new page (even though nothing really happens because it is just a change in the fragment id). Now, if the user now presses the “back” button now, they will “come back” to the “current page” from the “new page,” changing back from the new fragment id to the current fragment id.</li>
<li>Whenever the <code>window.location.hash</code> value changes (because (1) the <code>window.location.hash</code> value is set programmatically (2) the user presses the back/forward button or (3) the user pastes a “deep link” in the address bar), the <code>hashchange</code> event is triggered to the <code>window</code> object.</li>
</ol>
<p>Roughly, we will have to add the following logic to associate the three <code>appStates</code> — <code>AppState.List</code>, <code>AppState.Edit</code> and <code>AppState.Preview</code> — with the above three fragment id patterns:</p>
<ol type="1">
<li>Whenever <code>appState</code> changes, we set the appropriate fragment id to <code>window.location.hash</code>.</li>
<li>We create our custom handler for the <code>haschange</code> event, so that whenever the fragment id changes, our event handler takes appropriate actions.</li>
</ol>
<p>More specifically, make the following changes to <code>AppComponent</code>:</p>
<ol type="1">
<li><p>Add <code>onHashChange()</code> method to <code>AppComponent</code>. This method is our custom <code>hashchange</code> event handler. Whenever this method is called, it should ensure that <code>appState</code> and <code>currentPost</code> are set to the appropriate values for the new fragment id. Remember that this method may be called when (1) the <code>window.location.hash</code> value is programmatically updated (2) the user presses the back/forward button and (3) the user pastes a “deep link” in the address bar.</p></li>
<li><p>Change the <code>AppComponent</code> constructor (or its <code>ngOnInit()</code> lifecycle hook) so that after all blog posts have been fetched from the server, <code>appState</code> and <code>currentPost</code> are set to the appropriate values for the fragment id used to load the app. For example, if the app is accessed through a deep link with the fragment id <code>#/preview/2</code>, <code>appState</code> should be set to <code>AppState.Preview</code> and <code>currentPost</code> should be set to the post with <code>postid=2</code>. Also, add the following line to the end of the constructor (or <code>ngOnInit()</code>) to add <code>onHashChange()</code> as a <code>hashchange</code> event handler:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb33-1"><a href="#cb33-1"></a><span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;hashchange&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="va">this</span><span class="op">.</span><span class="fu">onHashChange</span>())<span class="op">;</span></span></code></pre></div></li>
<li><p>Whenever you update <code>appState</code> or <code>currentPost</code> in your code, add the statement <code>window.location.hash = "corresponding_fragment_id";</code>, so that the URL fragment id reflects the app state. Even better, after you add <code>window.location.hash = "corresponding_fragment_id";</code>, you may want to move most (if not all) <code>appState</code> change statements to <code>onHashChange()</code>, so that <code>appState</code> changes are managed centrally by a single function. You may want to do the same for <code>currentPost</code> change statements as well.</p></li>
</ol>
<p><strong>Note</strong>: A more “Angular” way to add our <code>onHashChange()</code> method to the <code>hashchange</code> event handler will be to decorate it with the <code>@HostListener</code> decorator like the following:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb34-1"><a href="#cb34-1"></a>@<span class="fu">HostListener</span>(<span class="st">&#39;window:hashchange&#39;</span>)</span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="fu">onHashChange</span>() <span class="op">{</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>    <span class="op">...</span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="op">}</span></span></code></pre></div>
<p>But what we did here will work just fine.</p>
<p>Now you have finished implementing all major requirements of Project 4 except the integration of user authentication. Before implementing the authentication part, you need to deploy your Angular App to your Express server.</p>
<h2 id="part-h-deploy-your-angular-app-to-express-server">Part H: Deploy Your Angular App to Express Server</h2>
<p>To deploy your Angular app to your Express server, take the following steps:</p>
<ol type="1">
<li><p>Build the production code of your Angular app by the command:</p>
<pre class="term"><code>$ ng build --base-href=/editor/ --deploy-url=/editor/ --prod=true</code></pre>
<p>Note the <code>--base-href</code> and <code>--deploy-url</code> options, which is required because our app will be deployed at the path <code>/editor/</code> not at the root <code>/</code>.</p></li>
<li><p>Once your production Angular code is built in the <code>dist/angular-blog/</code> directory, copy all files in the directory to the <code>editor</code> subdirectory of your Express server’s public folder (i.e., <code>public/editor/</code>).</p></li>
<li><p>If it is not running already, start your Express server by the command:</p>
<pre class="term"><code>$ npm start</code></pre></li>
<li><p>Visit <a href="http://localhost:3000/login" class="uri">http://localhost:3000/login</a> page of your Express server and authenticate yourself as <code>cs144</code>.</p>
<p><strong>Note</strong>: Notice that you are visiting <code>localhost:3000</code> not <code>localhost:4200</code>. You are accessing the Express server directly from your browser now, not through the Angular CLI proxy as you have done so far.</p></li>
<li><p>Load your Angular app by visiting <a href="http://localhost:3000/editor/" class="uri">http://localhost:3000/editor/</a> with your browser. If everything has been done correctly, your Angular app will be loaded from your Express server and start working. Again, note that the App is not coming from your <code>ng serve</code> development server at <code>localhost:4200</code>. In fact, the development server is no longer needed because everything is served by the Express server at this point.</p></li>
<li><p>Make sure that your Angular app functions correctly, even though it is now served from the Express server.</p></li>
</ol>
<p>Congratulations! You have successfully “deployed” your Angular app to the Express server.</p>
<h2 id="part-i-integrate-user-authentication">Part I: Integrate User Authentication</h2>
<p>Now that your Angular app is successfully deployed, your final task is to integrate user authentication with your Angular app. This can be done by adding the following logic to your Express server code:</p>
<p>In short, you have to add the code to your Express server that ensures that any request to <code>/editor/</code> contains a valid JWT. If not, responds with a redirect to <code>/login?redirect=/editor/</code> with status code 302. <strong>Remember that this change is all you need and no change is needed within your Angular App</strong>. As long as this change is made to your Express server, everything will work because of the following reason:</p>
<p>When the Express server gets a request at the path <code>/editor/</code>, it checks whether the request contains a valid JWT cookie. If yes, everything is fine because the user has already authenticated themselves. If not, it “forces” the user to authenticate themselves by responding with a redirect to <code>/login?redirect=/editor/</code>. When this response is received, the browser will redirect to the <code>/login?redirect=/editor/</code> page, letting the user login. If the user provides correct authentication information to <code>/login?redirect=/editor/</code> via the HTML form, your Express server responds with another redirect to <code>/editor/</code> due to the optional parameter <code>redirect=/editor/</code>. This time, the request to <code>/editor/</code> sent by the browser will be completed successfully because a valid JWT cookie is included.</p>
<p>Now you are all done! Please verify that all functionalities of your application work by accessing your Angular app deployed at the Express server, <a href="http://localhost:3000/editor/" class="uri">http://localhost:3000/editor/</a>. Make sure that it does not throw any errors in the Chrome Developer Tool, maybe except due to 4XX or 5XX responses from a server. This can be checked in chrome by right clicking the browser window and choose “inspect”. Then choose the “Console” tab to verify if any errors are appearing.</p>
<h2 id="part-j-style-your-application-using-css-optional">Part J: Style Your Application Using CSS (Optional)</h2>
<p>Once you finish developing the functional part of the Angular editor, the required part of Project 4 is over. But we encourage you to add CSS styling rules to your app, so that the interface is aesthetically more pleasing. This part, however, is completely optional. As long as your code functionally satisfies our requirements, you will get the full score for this project.</p>
<p>There are a number of ways that you can implement styling your site. You can specify the detailed CSS rules all by yourself, without relying on a third-party “CSS library.” This will help you learn the intricate detail of the CSS standard. Another way is to use a popular library for web page design and styling. For example, <a href="https://getbootstrap.com/">Bootstrap</a> is one of the most popular web front-end libraries developed by Twitter. <a href="https://bulma.io/">Bulma</a> is another very popular CSS framework. Learning a third-party library will take time and effort, but once learned, they make it simple to add beautiful and interactive interface to your web site.</p>
<p>You are welcome to use a third-party CSS library as long as you make sure that your submission runs on the grader’s machine. If you want to use a third party library, you will have to tell the Angular CLI that you want the third-party CSS (and JavaScript) files to be packaged together when your app is built and/or served. To do that, open the <code>angular.json</code> file and add the third-party CSS and JavaScript files to <code>styles</code> and <code>scripts</code> arrays like the following:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb37-1"><a href="#cb37-1"></a>...</span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="st">&quot;styles&quot;</span><span class="op">:</span> [</span>
<span id="cb37-3"><a href="#cb37-3"></a>    <span class="st">&quot;path/to/my/styles.css&quot;</span><span class="op">,</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>    <span class="st">&quot;src/styles.css&quot;</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>]<span class="op">,</span></span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="st">&quot;scripts&quot;</span><span class="op">:</span> [</span>
<span id="cb37-7"><a href="#cb37-7"></a>    <span class="st">&quot;path/to/my/javascript.js&quot;</span></span>
<span id="cb37-8"><a href="#cb37-8"></a>]<span class="op">,</span></span>
<span id="cb37-9"><a href="#cb37-9"></a>...</span></code></pre></div>
<p>Once the files are added to the arrays, you can use their styling rules in any of your components just like when you include the files via the <code>&lt;style&gt;</code> and <code>&lt;script&gt;</code> tags in a standard web page.</p>
<p>As an example setup instruction, if you decide to use <a href="https://bulma.io/">Bulma</a>, you just need to install the Bulman module</p>
<pre class="term"><code>$ npm install bulma</code></pre>
<p>include the location of Bulma CSS file to the <code>styles</code> array:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb39-1"><a href="#cb39-1"></a><span class="st">&quot;styles&quot;</span><span class="op">:</span> [</span>
<span id="cb39-2"><a href="#cb39-2"></a>    <span class="st">&quot;node_modules/bulma/css/bulma.css&quot;</span><span class="op">,</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>    <span class="st">&quot;src/styles.css&quot;</span></span>
<span id="cb39-4"><a href="#cb39-4"></a>]<span class="op">,</span></span></code></pre></div>
<p>Similarly, if you want to use Bootstrap, first install its module and its dependency</p>
<pre class="term"><code>npm install bootstrap</code></pre>
<p>and then add the relevant CSS and JS files to <code>styles</code> and <code>scripts</code> arrays:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb41-1"><a href="#cb41-1"></a><span class="st">&quot;styles&quot;</span><span class="op">:</span> [</span>
<span id="cb41-2"><a href="#cb41-2"></a>    <span class="st">&quot;node_modules/bootstrap/dist/css/bootstrap.css&quot;</span><span class="op">,</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>    <span class="st">&quot;src/styles.css&quot;</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>]<span class="op">,</span></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="st">&quot;scripts&quot;</span><span class="op">:</span> [</span>
<span id="cb41-6"><a href="#cb41-6"></a>    <span class="st">&quot;node_modules/bootstrap/dist/js/bootstrap.bundle.js&quot;</span></span>
<span id="cb41-7"><a href="#cb41-7"></a>]<span class="op">,</span></span></code></pre></div>
<!--
**Note**: If you need the library for karma testing as well, which is unlikely, you will have to add it to *both* `build.options.styles` and `test.options.styles` (and `scripts`). Most likely, you don't need it for karma testing and do not need to worry about adding it to `test.options.styles`.

To recognize the efforts that you may put into this part of the project, 
we give you as much as 10% extra credit,
if your efforts and dedication to this part is clear from your submission.
-->
<h2 id="submit-your-project">Submit Your Project</h2>
<h3 id="what-to-submit">What to Submit</h3>
<p>For this project, you will have to submit one zip file, named <code>project4.zip</code>, created using the packaging script provided below. This file will contain all source codes that you wrote for <strong>Projects 3 and 4</strong>. Before you package your code for submission, please do not forget adding the following <code>id</code> attribute values to various HTML elements in your app:</p>
<ol type="1">
<li>The “New Post” button in the List component should have the <code>id</code> attribute <code>list-new-button</code>.</li>
<li>Each blog post entry appearing in the List component should be in an HTML element with <code>id="list-post-:postid"</code> where <code>:postid</code> is the <code>postid</code> of the post.</li>
<li>The “Save”, “Delete”, and “Preview” buttons in the Edit component must have <code>id</code> attributes, <code>edit-save-button</code>, <code>edit-delete-button</code> and <code>edit-preview-button</code>, respectively.</li>
<li>The title and body input boxes/text areas in the Edit component must have <code>id</code> attributes, <code>edit-title</code> and <code>edit-body</code>, respectively.</li>
<li>The “Edit” button in the Preview component must have <code>id="preview-edit-button"</code>.</li>
<li>The rendered title and body in the Preview component must appear in HTML elements with the <code>id</code>s, <code>preview-title</code> and <code>preview-body</code>, respectively.</li>
</ol>
<h3 id="creating-project4.zip">Creating <code>project4.zip</code></h3>
<p>After you have verified that there is no issue with your project, you can package your work by running our <a href="./p4_package">packaging script</a>. Testing Project 4 requires running the blog-server of Project 3, so you will need to include your Projects 3 and 4 code in this submission. Roughly, the submitted zip file should be structured as follows:</p>
<pre><code>project4
  +- blog-server
  |    +- bin
  |    +- public
  |    +- routes
  |    +- views
  |    +- ...
  |    +- package.json
  |    +- app.js
  |    +- db.sh
  +- angular-blog
       +- e2e
       +- node_modules
       +- src 
       |    +- app
       |    |   +- ...
       |    +- assets
       |    +- environments
       |    +- index.html
       |    +- styles.css
       |    +- typings.d.ts
       |    +- ...
       +- ...</code></pre>
<p>Create a temporary directory, called <code>project4</code>, and place your Project 3 code in the <code>blog-server</code> subdirectory and your Project 4 code in the <code>angular-blog</code> subdirectory. Then download the <a href="./p4_package">packaging script</a> at the directory and execute it like <code>./p4_package</code>. The script will take a while to finish because it first builds a deployment version of your Angular code and then package it with other files. Once everything goes well, you will see a message like the following:</p>
<pre><code>...
Creating project4.zip file ...
[SUCCESS] Created &#39;/home/cs144/project4/project4.zip&#39;.</code></pre>
<p><strong>Please only submit this script-created project4.zip to GradeScope.</strong> Do not use any other ways to package or submit your work! To ensure that your code works well on the grading machine, we provide the deployment script <a href="./deploy.sh">deploy.sh</a> that will be used to run your code. Please download <a href="./deploy.sh">our script</a> and make sure that your code can be successfully deployed just with the following command:</p>
<pre class="term"><code>$ ./deploy.sh project4.zip

Deleting all documents and collections in the BlogServer database...
Loading initial documents to MongoDB using your db.sh...
Deploying your Angular code to the node server...
Installing dependent node modules...
Test deployment finished! Now your server is running at http://localhost:3000/
Visit http://localhost:3000/editor/ and make sure everything works as expected.
To stop the server, press Ctrl+C</code></pre>
<p>If everything goes well, you will see messages like above. Once your see the above message, please visit <a href="http://localhost:3000/editor/" class="uri">http://localhost:3000/editor/</a> from your host web browser and make sure that your site works as expected. Roughly, the following functionalities are tested during our grading of your code:</p>
<ol type="1">
<li>Your submitted code successfully runs with <code>./deploy.sh project4.zip</code></li>
<li>Authentication redirect
<ul>
<li>If you try to access <code>/editor/</code> without authentication, you are redirected to login page</li>
<li>Once you login as a valid user, you are redirected back to the angular editor app</li>
</ul></li>
<li>List component
<ul>
<li>Your list component shows all blog posts from the user and contains a “new post” button</li>
<li>Pressing a post in the list:
<ul>
<li>Opens the edit component with the clicked post on the right</li>
<li>URL fragment ID changes to <code>#/edit/:postid</code></li>
</ul></li>
<li>Pressing the new button
<ul>
<li>Opens a new empty blog on the right</li>
<li>URL fragment ID changes to <code>#/edit/0</code></li>
</ul></li>
</ul></li>
<li>Edit component
<ul>
<li>Your edit view contains title box, body box, and “save”, “delete”, and “preview” buttons</li>
<li>When “preview” button is pressed
<ul>
<li>URL fragment ID changes to <code>#/preview/:postid</code></li>
</ul></li>
<li>When “save” button is pressed
<ul>
<li>If it is an existing post:
<ul>
<li>The post is updated in MongoDB</li>
<li>Its modified time is changed to the current time</li>
</ul></li>
<li>If it is a new post:
<ul>
<li>The post is added to the list pane (It is OK this happens at the time when “new post” button is pressed)</li>
<li>The post is saved in MongoDB</li>
<li>The post’s postid and created time reflects its true value</li>
</ul></li>
</ul></li>
<li>When “delete” button is pressed
<ul>
<li>If it is a new post:
<ul>
<li>(If the post was added to list pane when the new button was pressed, it is removed from the list pane)</li>
<li>Post is deleted from MongoDB</li>
<li>URL fragment ID changes to <code>#/</code></li>
</ul></li>
<li>If it is an existing post:
<ul>
<li>The post disappears from the list pane</li>
<li>The post is deleted from MongoDB</li>
<li>URL fragment ID changes to <code>#/</code></li>
</ul></li>
</ul></li>
</ul></li>
<li>Preview component
<ul>
<li>Your preview component displays the post rendered in HTML and contains the “edit” button</li>
<li>When “edit” button is pressed:
<ul>
<li>URL fragment ID changes to <code>#/edit/:postid</code></li>
</ul></li>
</ul></li>
<li>Deep link and back button
<ul>
<li>When the app is accessed through <a href="http://localhost:3000/editor/" class="uri">http://localhost:3000/editor/</a>, it starts with the list component only</li>
<li>Pasting deep links like <a href="http://localhost:3000/editor/#/edit/1" class="uri">http://localhost:3000/editor/#/edit/1</a> and <a href="http://localhost:3000/editor/#/preview/1" class="uri">http://localhost:3000/editor/#/preview/1</a> displays correct post</li>
<li>When the page is “refeshed” by pressing the browser refresh button at a deep link, the browser comes back to the same state as before without any error</li>
<li>Accessing invalid deep links like <a href="http://localhost:3000/editor/#/lovestory" class="uri">http://localhost:3000/editor/#/lovestory</a>, <a href="http://localhost:3000/editor/#/preview/-21" class="uri">http://localhost:3000/editor/#/preview/-21</a> does not create a problem. Accessing a deep link with nonexisting post like <a href="http://localhost:3000/editor/#/edit/2036" class="uri">http://localhost:3000/editor/#/edit/2036</a> does not create a problem.</li>
<li>Pressing the browser back button moves the app to the prior state within the app, not exits the app</li>
</ul></li>
</ol>
<h2 id="further-reading-and-study">Further Reading and Study</h2>
<p>Before you go, we recommend a few articles and tutorials for further study.</p>
<p>First of all, either in our class or in the project, we did not cover the “modern tool chains” that are used by web developers in detail, including package mangers, module bundlers, transpilers, and task runners. Fortunately, Angular integrates these tools as part of its CLI and hides their complexities behind a few <code>ng</code> commands. But at some point you will have to know exactly what these tools are and when and why they are needed. To learn more on this topic, read the following article:</p>
<p><a href="https://medium.com/the-node-js-collection/modern-javascript-explained-for-dinosaurs-f695e9747b70">Modern JavaScript Explained For Dinosaurs</a></p>
<p>Second, the following article explains how complex web apps can be developed by (1) splitting them into simple components, (2) hierarchically composing the identified components into more complex forms, and (3) associating each component with minimal local states:</p>
<p><a href="https://reactjs.org/docs/thinking-in-react.html">Thinking in React</a></p>
<p>Even though the article explains this development approach in the context of the React library, we took essentially the same approach in our Angular app development as well. In fact, if you are familiar with React, you may have noticed that our <code>AppComponent</code> works as a central place where all application states are stored and managed, a role typically played by the <a href="https://redux.js.org/">Redux library</a> in React.</p>
<p>The following article generalizes this approach even more and explains modular and composable front-end development in a more general terms:</p>
<p><a href="https://increment.com/frontend/on-composable-modular-frontends/">On composable, modular frontends</a></p>
<p>As you can see from the articles, the design principle we used in this project is not limited to the Angular framework, but is applicable to any modern app development with UI elements, including everyday mobile apps.</p>
<p>Finally, note that while this project mainly focused on building a “desktop-like web application” using Angular, Angular is a great tool to build a more “traditional” web site as well. We strongly encourage you to watch this <a href="https://scotch.io/courses/build-your-first-angular-website/">two-hour tutorial</a> to learn how to do it.</p>
<p>These are a lot of articles and tutorials to read and study and we understand that you may not have the time to read them all now. But if you are serious about web development, you will find that the information in the linked articles are invaluable.</p> 
</body>
</html>
