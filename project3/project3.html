<!DOCTYPE html>
<html lang="en">
<!-- ***IMPORTANT***: This page is autogenerated from a markdown file
         DO NOT EDIT THIS FILE DIRECTLY.
	 Your edits will disappear when this page is regenerated  -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        code{white-space: pre-wrap;}
        span.smallcaps{font-variant: small-caps;}
        span.underline{text-decoration: underline;}
        div.line-block{white-space: pre-line;}
        div.column{display: inline-block; vertical-align: top; width: 50%;}
        pre{background-color:#e7e7e7; border: solid 1px #000000; padding: 5px;}
        code{background-color:#e7e7e7; padding: 1px;}
        code.sourceCode > span { display: inline-block; line-height: 1.25; }
        code.sourceCode > span { color: inherit; text-decoration: inherit; }
        code.sourceCode > span:empty { height: 1.2em; }
        .sourceCode { overflow: visible; }
        code.sourceCode { white-space: pre; position: relative; }
        div.sourceCode { margin: 1em 0; }
        pre.sourceCode { margin: 0; }
        @media screen {
        div.sourceCode { overflow: auto; }
        }
        @media print {
        code.sourceCode { white-space: pre-wrap; }
        code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
        }
        pre.numberSource code
          { counter-reset: source-line 0; }
        pre.numberSource code > span
          { position: relative; left: -4em; counter-increment: source-line; }
        pre.numberSource code > span > a:first-child::before
          { content: counter(source-line);
            position: relative; left: -1em; text-align: right; vertical-align: baseline;
            border: none; display: inline-block;
            -webkit-touch-callout: none; -webkit-user-select: none;
            -khtml-user-select: none; -moz-user-select: none;
            -ms-user-select: none; user-select: none;
            padding: 0 4px; width: 4em;
            color: #aaaaaa;
          }
        pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
        div.sourceCode
          {   }
        @media screen {
        code.sourceCode > span > a:first-child::before { text-decoration: underline; }
        }
        code span.al { color: #ff0000; } /* Alert */
        code span.an { color: #008000; } /* Annotation */
        code span.at { } /* Attribute */
        code span.bu { } /* BuiltIn */
        code span.cf { color: #0000ff; } /* ControlFlow */
        code span.ch { color: #008080; } /* Char */
        code span.cn { } /* Constant */
        code span.co { color: #008000; } /* Comment */
        code span.cv { color: #008000; } /* CommentVar */
        code span.do { color: #008000; } /* Documentation */
        code span.er { color: #ff0000; font-weight: bold; } /* Error */
        code span.ex { } /* Extension */
        code span.im { } /* Import */
        code span.in { color: #008000; } /* Information */
        code span.kw { color: #0000ff; } /* Keyword */
        code span.op { } /* Operator */
        code span.ot { color: #ff4000; } /* Other */
        code span.pp { color: #ff4000; } /* Preprocessor */
        code span.sc { color: #008080; } /* SpecialChar */
        code span.ss { color: #008080; } /* SpecialString */
        code span.st { color: #008080; } /* String */
        code span.va { } /* Variable */
        code span.vs { color: #008080; } /* VerbatimString */
        code span.wa { color: #008000; font-weight: bold; } /* Warning */
        .sourceCode{overflow: auto;}
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body, {delimiters: [ {left: '\\[', right: '\\]', display: true}, {left: '$$', right: '$$', display: true}, {left: '\\(', right: '\\)', display: false}, {left: '$', right: '$', display: false} ]});"></script>
    <link rel="stylesheet" href="/libs/fonts/fonts.css">
    <link rel="stylesheet" href="/libs/css/pandoc.css">
    <title>CS144: Web Applications</title>
</head>
<body>
<h1 id="project-3-blogging-server-on-nodejs-and-mongodb">Project 3: Blogging Server on NodeJS and MongoDB</h1>
<h2 id="overview">Overview</h2>
<p>The primary task of Project 3 is to implement the website for our markdown-based blogging service that (1) lets anyone read blogs written by our users through public URLs and (2) lets our registered users create and update their own blogs after password authentication. Through this process, we will learn how to develop a back-end service using NodeJS, Express and MongoDB.</p>
<p>Note that your implementation of Project 3 will be used for your Project 4 as well. Since Project 4 is dependent on Project 3, it is important that you <strong>follow instructions on this spec exactly</strong> to avoid any potential issues later in Project 4.</p>
<h2 id="development-environment">Development Environment</h2>
<p>All development for Projects 3 (and 4) will be done on a Docker container based on the “junghoo/mean” image:</p>
<pre class="term"><code>$ docker run -it -p3000:3000 -p4200:4200 -v {host_shared_dir}:/home/cs144/shared --name mean junghoo/mean</code></pre>
<p>Make sure to replace <code>{host_shared_dir}</code> with the name of the shared directory on your host. The above command creates a docker container named <code>mean</code> with appropriate port forwarding and directory sharing. Once created, you can start the container simply by issuing the following command in a terminal window:</p>
<pre class="term"><code>$ docker start -i mean</code></pre>
<p>This container has MongoDB (v4.4.4), NodeJS (v14.16.0), Express application generator (v4.16.1), and Angular CLI (v11.2.6) pre-installed. Make sure that they run fine through the following commands:</p>
<pre class="term"><code>$ mongo --version
$ node --version
$ express --version
$ ng --version</code></pre>
<h2 id="project-requirements">Project Requirements</h2>
<p>Our back-end blogging service should be accessible at the following URLs:</p>
<table>
<colgroup>
<col style="width: 1%" />
<col style="width: 19%" />
<col style="width: 5%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="header">
<th>#</th>
<th>URL</th>
<th>method</th>
<th>functionality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>/blog/:username/:postid</code></td>
<td>GET</td>
<td>Return an HTML-formatted page that shows the blog post with <code>postid</code> written by <code>username</code>.</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>/blog/:username</code></td>
<td>GET</td>
<td>Return an HTML page that contains first 5 blog posts by <code>username</code>.</td>
</tr>
<tr class="odd">
<td>3</td>
<td><code>/login</code></td>
<td>GET, POST</td>
<td>Authenticate the user through username and password.</td>
</tr>
<tr class="even">
<td>4</td>
<td><code>/api/posts</code></td>
<td>GET, POST, DELETE</td>
<td>This is the REST API used to insert, retieve, update, and delete blog posts</td>
</tr>
</tbody>
</table>
<p><em>Note</em>:</p>
<ol type="1">
<li><p>The URL patterns 1-3 should be publicly accessible by anyone. No prior user authentication should be required to access these URLs. More detailed requirements for the URL patterns 1-2 and 3 will be given in Parts B and C, respectively.</p></li>
<li><p>The URL pattern 4 should be protected behind authentication. More detailed specifications on this API will be given later in Part D.</p></li>
<li><p>The implemented server should listen on <strong><em>port 3000</em></strong> for HTTP requests.</p></li>
</ol>
<p>All blog posts and the users’ authentication credentials should be stored in the MongoDB server. The MongoDB server should have at least the following two collections, “Posts” and “Users”, in the database “BlogServer”.</p>
<ol type="1">
<li><p><strong>Collection: Posts</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a>[<span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;cs144&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669344517</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669344517</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 1&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;Hello, world!&quot;</span> <span class="op">},</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;cs144&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669658420</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669658420</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 2&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;I am here.&quot;</span> <span class="op">},</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758320</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758320</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 3&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;today&#39;s a nice day&quot;</span> <span class="op">},</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758330</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758340</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 4&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;today&#39;s a nice day&quot;</span> <span class="op">},</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758350</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758350</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 5&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;today&#39;s a nice day&quot;</span> <span class="op">},</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758360</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758360</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 6&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;today&#39;s a nice day&quot;</span> <span class="op">},</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758370</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758370</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 7&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;gotta do my homework&quot;</span> <span class="op">},</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758380</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758380</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 8&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;today&#39;s a nice day&quot;</span> <span class="op">}</span>]</span></code></pre></div>
<p>The first collection “Posts” stores all blog posts created and saved by our users and must have eight initial documents shown above. As users write more blog posts, more documents should be inserted into this collection. Note that “created” and “modified” fields of the two documents are all integers, whose values are milliseconds since the the Unix epoch (Jan 1, 1970 UTC).</p></li>
<li><p><strong>Collection: Users</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a>[<span class="op">{</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;cs144&quot;</span><span class="op">,</span> <span class="st">&quot;password&quot;</span><span class="op">:</span> <span class="st">&quot;$2a$10$2DGJ96C77f/WwIwClPwSNuQRqjoSnDFj9GDKjg6X/PePgFdXoE4W6&quot;</span><span class="op">,</span> <span class="st">&quot;maxid&quot;</span><span class="op">:</span> <span class="dv">2</span> <span class="op">},</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="op">{</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;password&quot;</span><span class="op">:</span> <span class="st">&quot;$2a$10$kTaFlLbfY1nnHnjb3ZUP3OhfsfzduLwl2k/gKLXvHew9uX.1blwne&quot;</span><span class="op">,</span> <span class="st">&quot;maxid&quot;</span><span class="op">:</span> <span class="dv">6</span> <span class="op">}</span>]</span></code></pre></div>
<p>The second collection “Users” stores the users’ authentication credentials and the current “maximum postid” of the user. The collection must have two initial documents shown above. The “password” field will be used for authenticating any user to our server through the URL pattern 3. The “maxid” field is used to easily calculate the postid to be assigned to a new posting. Note that <strong>users’ passwords must NEVER be stored in plaintext</strong>. Instead, we have to store them only after we apply a cryptographic one-way hash function. This ensures that even if a hacker breaks into our system and gets a hold of our database, they won’t be able to obtain the users’ passwords easily since it is time-consuming to recover the plaintext passwords from the hash values. The downside of this approach is that when a user tries to login, we will have to apply the same cryptographic hash function to the user-provided password and then match the equivalence of this hash value to what is stored in our database. This can potentially increase the computational overhead of authenticating a user, but given the potential security risk of saving plaintext passwords, it is the cost that we are willing to pay. In our case, we applied <a href="https://en.wikipedia.org/wiki/Bcrypt">bcrypt hash function</a> to each user’s password (“password” for “cs144” and “blogserver” for “user2”, respectively) using the <a href="https://www.npmjs.com/package/bcryptjs">bcryptjs module</a> of node.js.</p></li>
</ol>
<h2 id="part-a-create-initial-mongodb-data">Part A: Create Initial MongoDB Data</h2>
<p>In Project 3, all blog posts must be managed by MongoDB. Unlike MySQL, MongoDB doesn’t have the concept of schema. All types of data are saved as <em>documents</em> in a <em>collection</em>. Since MongoDB document is essentially a JSON object, it is often a preferred back-end data storage engine for JavaScript-based development.</p>
<p>When you start the Docker container, it starts MongoDB server in the background. So you can start the “MongoDB command-line shell” simply by:</p>
<pre class="term"><code>$ mongo</code></pre>
<p>Once you are inside the shell, you can issue most MongoDB commands interactively. Go over <a href="../notes/mongo.html">class notes on MongoDB</a> to review the basic MongoDB commands. If needed, review online tutorials on MongoDB, such as <a href="https://www.tutorialspoint.com/mongodb/index.htm">this one</a>.</p>
<p>Now <em>write a script named <code>db.sh</code> that includes the sequence of mongodb shell commands that load the following documents into the two collections, “Posts” and “Users”, in the “BlogServer” database</em>:</p>
<ol type="1">
<li><p><strong>Collection: Posts</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1"></a>[<span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;cs144&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669344517</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669344517</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 1&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;Hello, world!&quot;</span> <span class="op">},</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;cs144&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669658420</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669658420</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 2&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;I am here.&quot;</span> <span class="op">},</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758320</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758320</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 3&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;today&#39;s a nice day&quot;</span> <span class="op">},</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758330</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758340</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 4&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;today&#39;s a nice day&quot;</span> <span class="op">},</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758350</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758350</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 5&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;today&#39;s a nice day&quot;</span> <span class="op">},</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758360</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758360</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 6&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;today&#39;s a nice day&quot;</span> <span class="op">},</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758370</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758370</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 7&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;gotta do my homework&quot;</span> <span class="op">},</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="op">{</span> <span class="st">&quot;postid&quot;</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;created&quot;</span><span class="op">:</span> <span class="dv">1518669758380</span><span class="op">,</span> <span class="st">&quot;modified&quot;</span><span class="op">:</span> <span class="dv">1518669758380</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">:</span> <span class="st">&quot;## Title 8&quot;</span><span class="op">,</span> <span class="st">&quot;body&quot;</span><span class="op">:</span> <span class="st">&quot;today&#39;s a nice day&quot;</span> <span class="op">}</span>]</span></code></pre></div></li>
<li><p><strong>Collection: Users</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1"></a>[<span class="op">{</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;cs144&quot;</span><span class="op">,</span> <span class="st">&quot;password&quot;</span><span class="op">:</span> <span class="st">&quot;$2a$10$2DGJ96C77f/WwIwClPwSNuQRqjoSnDFj9GDKjg6X/PePgFdXoE4W6&quot;</span><span class="op">,</span> <span class="st">&quot;maxid&quot;</span><span class="op">:</span> <span class="dv">2</span> <span class="op">},</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="op">{</span> <span class="st">&quot;username&quot;</span><span class="op">:</span> <span class="st">&quot;user2&quot;</span><span class="op">,</span> <span class="st">&quot;password&quot;</span><span class="op">:</span> <span class="st">&quot;$2a$10$kTaFlLbfY1nnHnjb3ZUP3OhfsfzduLwl2k/gKLXvHew9uX.1blwne&quot;</span><span class="op">,</span> <span class="st">&quot;maxid&quot;</span><span class="op">:</span> <span class="dv">6</span> <span class="op">}</span>]</span></code></pre></div></li>
</ol>
<p>We also provide two JSON files that contain the above documents, <a href="posts.json">posts.json</a> and <a href="users.json">users.json</a>, in case they are helpful. Note that in our provided data, the user “cs144”’s password is “password” and “user2”’s password is “blogserver”.</p>
<p>Note that “created” and “modified” fields of the post documents are all integers, whose values represent the milliseconds since the the Unix epoch (Jan 1, 1970 UTC). You must store all date fields in this format. Also recall that the above password values are obtained by applying the bcrypt cryptographic one-way hash function.</p>
<p>Note that your provided script <code>db.sh</code> will be executed through the following command</p>
<pre class="term"><code>$ mongo &lt; db.sh</code></pre>
<p>before we grade your submission to initialize the MongoDB database for the server.</p>
<p><strong>Note:</strong>：</p>
<p>Your db.sh script must strictly follow the instructions above. Please make sure that the database names, the collection names, and their contents are <strong><em>exactly the same as this instruction including their case</em></strong>. Since MongoDB is <strong><em>CASE SENSITIVE</em></strong>, your submission will fail our test script even for a minor case mismatch and lead to a very low grade.</p>
<p><strong>Notes on CR/LF issue:</strong> If your host OS is Windows, you need to pay attention to how each line ends in your script file. Windows uses a pair of CR (carriage return) and LF (line feed) characters to terminate lines, but Unix uses only a LF character. Therefore, problems may arise when you feed a text file generated from a Windows program to a Unix tool such as <code>mongo</code>. If you encounter any wired error when you run your script, you may want to run the <code>dos2unix</code> command in the container on your script file to fix line end characters.</p>
<h2 id="part-b-implement-public-html-blog-web-pages">Part B: Implement Public HTML Blog Web Pages</h2>
<p>As the second task of Project 3, we now implement the public URLs by which any user can view blog posts published on our website. In particular, we will implement a server that returns an HTML page to an HTTP request to the following URL patterns:</p>
<table>
<colgroup>
<col style="width: 1%" />
<col style="width: 19%" />
<col style="width: 5%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="header">
<th>#</th>
<th>URL</th>
<th>method</th>
<th>functionality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>/blog/:username/:postid</code></td>
<td>GET</td>
<td>Return an HTML-formatted page that shows the blog post with <code>postid</code> written by <code>username</code>.</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>/blog/:username</code></td>
<td>GET</td>
<td>Return an HTML page that contains first 5 blog posts (by <code>postid</code>) from <code>username</code>. If the user has more than 5 posts, the page should contain a “next” button (or hyperlink) that link to the next 5 posts (according to the postid) by the user.</td>
</tr>
</tbody>
</table>
<p>Return status code <code>404</code> for the above routes if either the <code>:username</code> or <code>:postid</code> does not exist in the database.</p>
<p>We use node.js JavaScript runtime engine and its express module to implement our back-end server. Node.js is built on Chrome’s V8 JavaScript engine, which uses an event-driven, non-blocking I/O model to make it lightweight and efficient. Express is a module that provides an easy-to-use routing mechanism, HTML template integration, and third-party middleware integration. You may want to go over the <a href="../notes/node.html">class lecture note on node.js</a> to brush up on node.js and express. If you need more detailed instruction on how to use them, <a href="https://www.w3schools.com/nodejs/default.asp">online tutorials like this</a> can be helpful. Express web site has more detailed documentation on <a href="https://expressjs.com/en/guide/routing.html">routing</a> and <a href="https://expressjs.com/en/guide/using-template-engines.html">using a template engine</a>.</p>
<h3 id="generate-server-skeleton-code">Generate Server Skeleton Code</h3>
<p>To generate the skeleton code for our web server, we will use the <a href="https://expressjs.com/en/starter/generator.html">Express application generator</a>. Initialize the project under a project directory (e.g. <code>blog-server</code>):</p>
<pre class="term"><code>$ express --view=ejs blog-server</code></pre>
<p>Here <code>--view=ejs</code> option makes the generated code use the “EJS” template engine for generating HTML pages from JSON. <em>You are welcome to use other template engine for your development</em>, but our project spec gives instructions for “EJS”. When the above command is executed, you see the following folder and file structure within the <code>blog-server</code> directory:</p>
<pre><code>blog-server
 +- bin
 +- public
 +- routes
 +- views
 +- package.json
 +- app.js</code></pre>
<p>Here the <code>app.js</code> file serves as the entrance of the whole project. If you define other .js files, you need to reach them starting from app.js. The <code>package.json</code> file contains some meta information on the project including its “package dependencies”. When you add new dependencies to this file and run <code>npm install</code>, <code>npm</code> will install all dependent modules into the subdirectory <code>node_modules</code>. The <code>public</code> directory contains static resources that are made available on the developed web site, like HTML, CSS, JavaScript, and image files. The <code>views</code> directory contains HTML template files. The <code>routes</code> directory contains “middleware” that processes the requests. The <code>bin</code> directory contains the executable file. As you develop your code, you are welcome to add or modify any directory or file as needed.</p>
<p>Make sure that the generated code works properly on our container by executing the following commands:</p>
<pre class="term"><code>$ npm install
$ npm start</code></pre>
<p>The <code>npm install</code> command installs all dependent node packages specified in the <code>package.json</code> file. The <code>npm start</code> command executes “start script” specified in <code>package.json</code> (which is <code>node ./bin/www</code> in the auto-generated <code>package.json</code> file). Open a web browser on your host machine and make sure that you see a page similar to the following image at <a href="http://localhost:3000/" class="uri">http://localhost:3000/</a>:</p>
<p><img src="hello.jpg" width="500" /></p>
<h3 id="install-mongodb-and-commonmark-modules">Install mongodb and commonmark Modules</h3>
<p>To generate public HTML blog pages using node.js, express, and MongoDB, we need a MongoDB client library for node.js and a markdown-to-HTML rendering library. We will use the <a href="https://www.npmjs.com/package/mongodb">official MongoDB driver for node.js</a> and the <a href="https://www.npmjs.com/package/commonmark">commonmark.js library</a> for this purpose. Install these two packages using <code>npm</code></p>
<pre class="term"><code>$ npm install mongodb
$ npm install commonmark</code></pre>
<p>Note that commonmark.js’s API is almost identical to the Java version, so you will find it easy to use.</p>
<p>In case you are not familiar with the MongoDB native client API, go over <a href="../mongo/mongo-node.html">Using MongoDB with Node Tutorial</a> and read the <a href="http://mongodb.github.io/node-mongodb-native/3.5/tutorials/crud/">MongoDB tutorial on CRUD operations</a> to learn the basics.</p>
<p><strong>Note:</strong> Due to a strange interaction between node, Docker container, and shared folder, you may sometimes get an error similar to the following when you run <code>node</code> or <code>npm</code>:</p>
<pre class="term"><code>path.js:1177
           cwd = process.cwd();
                        ^
Error: ENOENT: no such file or directory, uv_cwd</code></pre>
<p>If you get the above error, you can “fix it” by <code>cd ../</code>, cd back, and try again.</p>
<h3 id="learn-the-template-syntax">Learn the Template Syntax</h3>
<p>The responses to the two URL patterns shown above should be all in HTML. For generating an HTML response, you can use a <em>template engine</em>. When you use a template engine, you just need to write a static “template file”, and “render” the final HTML response by combining the template with data.</p>
<p>EJS (Embedded JavaScript) uses a template syntax very similar to Java ServePages (JSP). Like JSP, you can use the standard HTML tags in the template, and sprinkle your JavaScript code inside <code>&lt;% ... %&gt;</code>, <code>&lt;%= ... %&gt;</code>, or <code>&lt;%- ... %&gt;</code> tags. <code>&lt;%= ... %&gt;</code> or <code>&lt;%- ... %&gt;</code> can include any expression and is replaced with the output string of the expression. The difference between the two is that <code>&lt;%= ... %&gt;</code> escapes HTML tags in the output, so that the HTML tags are displayed as strings, while <code>&lt;%- ... %&gt;</code> does not escape HTML tags, so that the browser can interpret them as HTML tags. <code>&lt;% ... %&gt;</code> can include any arbitrary JavaScript code, not just expressions.</p>
<p>Here is an example of a valid EJS template:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">&lt;ul&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>    <span class="er">&lt;</span>% for(let i = 0; i <span class="er">&lt;</span> books.length; i++) { %&gt;</span>
<span id="cb15-3"><a href="#cb15-3"></a>        <span class="kw">&lt;li&gt;</span><span class="er">&lt;</span>%- books[i].isbn %&gt;<span class="kw">&lt;/li&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="er">&lt;</span>% } %&gt;</span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="kw">&lt;/ul&gt;</span></span></code></pre></div>
<p>For more EJS examples, look at the generated template files in the <code>views</code> directory. You may also want to go over an <a href="https://scotch.io/tutorials/use-ejs-to-template-your-node-application">online tutorial like this</a> to learn more on EJS.</p>
<h3 id="implement-blogusernamepostid-and-blogusername">Implement <code>/blog/:username/:postid</code> and <code>/blog/:username</code></h3>
<p>Now that you know the basics to implement Part B, go ahead and implement it. The responses from <strong>these two URL patterns must meet the following requirements:</strong></p>
<ol type="1">
<li><p>All blog posts returned from the two URL patterns should be rendered in HTML from markdown using the <code>commonmark.js</code> module, both title and body.</p></li>
<li><p>The second URL pattern <code>/blog/:username</code> must return the first 5 posts (by <code>postid</code>) from <code>username</code>. When there are more posts from the user the returned page must contain a “next” link, which points to a page with the next 5 posts according to the postid by the user. <strong><em>Make sure that the “next” link is implemented as an HTML <code>&lt;a&gt;</code> element with <code>id="next_link"</code> and <code>href</code> pointing to the URL of the “next page”.</em></strong></p></li>
<li><p>If <code>:username</code> is missing in the request or <code>:username</code> or <code>:postid</code> does not exist in the database, return status code <code>404</code>.</p></li>
<li><p>The second URL pattern <code>/blog/:username</code> must take an <em>optional query string</em> <code>start=:postid</code>, like</p>
<pre><code>/blog/cs144?start=3</code></pre>
<p>When this optional query string exists, the response must include the next 5 posts by <code>cs144</code> whose <code>postid</code> is 3 or above.</p></li>
</ol>
<p><strong>Note</strong>:</p>
<ol type="1">
<li>In implementing this part, remember that a request can be “routed” to a callback function through <code>app.METHOD(URL, callback)</code>, like <code>app.get('/blog/:username', callback)</code>, or using <code>app.use(path-prefix, callback)</code>. Inside the callback function, you can reference the HTTP request through the first <a href="http://expressjs.com/en/api.html#req">req parameter</a>, and you can generate the response through the second <a href="http://expressjs.com/en/api.html#res">res parameter</a>.</li>
<li>In our project, all dates are stored as a number in MongoDB, which represents milliseconds since the the Unix epoch (Jan 1, 1970 UTC). You can convert a JavaScript <code>Date</code> object to this number using its <code>getTime()</code> method. Conversely, you can convert this number to a <code>Date</code> object by passing it as the constructor parameter of <code>Date</code> or by calling a date object’s <code>setTime()</code> method.</li>
<li>Please remember that all MongoDB commands must be executed <em>asynchronously</em> either using callback functions or using a <code>Promise</code> object (potentially with <code>await</code> keyword).</li>
<li>To minimize the overhead from creating a connection to the database server, we strongly recommend that you create a connection to the MongoDB server when your application starts up and reuse the created connection for all MongoDB commands. This has been explained in <a href="../mongo/mongo-node.html">Using MongoDB with Node Tutorial</a>.</li>
<li>If you get an error like “listen EADDRINUSE: address already in use 3000” when you run your code, it is likely because you are calling <code>app.listen(3000)</code> multiple times in your code. Note that in the Express generated code, the <code>app.listen()</code> call is already made in the “bin/www” file. You either should not call <code>app.listen()</code> yourself or delete the existing <code>app.listen()</code> call in <code>/bin/www</code>.</li>
</ol>
<h2 id="part-c-implement-user-login-page">Part C: Implement User Login Page</h2>
<p>In this part, we will implement the user login page available at the following URL:</p>
<table>
<thead>
<tr class="header">
<th>#</th>
<th>URL</th>
<th>method</th>
<th>functionality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>/login</code></td>
<td>GET, POST</td>
<td>Authenticate the user through username and password.</td>
</tr>
</tbody>
</table>
<p>Here are more detailed descriptions of the above API:</p>
<ol type="1">
<li><p><strong>GET /login</strong>: The request may optionally include <code>redirect=:redirect</code> query string. Given the request, the server should return an HTML page that contains an HTML <code>&lt;form&gt;</code> with at least two <code>&lt;input&gt;</code> elements with names <code>username</code> and <code>password</code>. When the user inputs their username and password in these input elements, and presses the submit button, the page should issue a request <code>POST /login</code> with <code>username=:username&amp;password=:password&amp;redirect=:redirect</code> in the body, where the <code>redirect=:redirect</code> is added only if it was included as part of the <code>GET /login</code> request.</p>
<p><strong>Note:</strong> Remember that when a browser generates an HTTP request from <code>&lt;form&gt;</code> fields with <code>POST</code> method, user inputs are included in the <em>body</em> of the generated request with <code>Content-Type: application/x-www-form-urlencoded</code>.</p></li>
<li><p><strong>POST /login</strong>: The request body must contain <code>username=:username&amp;password=:password</code>, optionally with <code>redirect=:redirect</code>, with <code>Content-Type: application/x-www-form-urlencoded</code>. Depending on the passed parameters, you need to take the following action:</p>
<ol type="A">
<li>If the request does not have <code>username</code> or <code>password</code> parameter, the server must return the status code “401 (Unauthorized)”.</li>
<li>If the request has <code>username</code> and <code>password</code> parameters:
<ol type="i">
<li>If the provided <code>username</code> and <code>password</code> do not match our record, the server must return the status code “401 (Unauthorized)”. The response body must include an HTML <code>&lt;form&gt;</code> with username and password <code>&lt;input&gt;</code> elements, so that the user can reattempt authentication.</li>
<li>If the provided <code>username</code> and <code>password</code> match our record, the server must set an authentication session cookie in JSON Web Token (JWT) (more on this later) and
<ol type="a">
<li>If the request does not contain <code>redirect</code> parameter, the server must return status code “200 (OK)” with the body saying that the authentication was successful.</li>
<li>If the request contains <code>redirect</code> parameter, the server must redirect the browser to <code>:redirect</code> by returning the status code “302 (Found)” together with the HTTP header <code>Location:</code> pointing to the <code>:redirect</code> value from the request. Note that <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Redirections">the MDN page on HTTP redirections</a> explains different mechanisms for redirecting the browser to a different page automatically and the <a href="http://expressjs.com/en/api.html#res.redirect">res.redirect()</a> function can be used to generate <code>3XX</code> redirect response in Express.</li>
</ol></li>
</ol></li>
</ol></li>
</ol>
<p>Recall that our MongoDB server stores all users’ credentials in the “Users” collection of the “BlogServer” database. In addition, recall that the stored user passwords are all hash values obtained by applying the bcrypt hash function. Therefore, to match a user’s stored password against what she provides during authentication, you will need to use node.js <a href="https://www.npmjs.com/package/bcryptjs">bcryptjs module</a>. Install the module through the following command:</p>
<pre class="term"><code>$ npm install bcryptjs</code></pre>
<p>Read the <a href="https://www.npmjs.com/package/bcryptjs">bcryptjs package page</a> to learn how you can use it to compare a user’s password against a hash value.</p>
<h3 id="json-web-token-jwt">JSON Web Token (JWT)</h3>
<p>Once the user’s authenticity is established through the user-provided password, our server must establish a “authenticated session”, so that it can recognize that any future request coming from the same browser comes from the authenticated user. There are a number of ways to implement this. In this project, you must use <a href="https://jwt.io/">JSON Web Token (JWT)</a> for this purpose. If you are not familiar with JWT, go over the <a href="https://jwt.io/introduction/">JWT introduction page</a> to learn what it is and how it can be used.</p>
<p>In your implementation, once the user is authenticated, you must set a <em>transient session cookie</em> (a cookie that has no expiration date, so that it is forgotten once the browser is closed) whose name is <code>jwt</code> and whose value is the following JWT:</p>
<ol type="1">
<li><p>Its header must have at least two claims, ‘alg’ (algorithm) and ‘typ’ (type), with the following values:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1"></a><span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="st">&quot;alg&quot;</span><span class="op">:</span> <span class="st">&quot;HS256&quot;</span><span class="op">,</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="st">&quot;typ&quot;</span><span class="op">:</span> <span class="st">&quot;JWT&quot;</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="op">}</span></span></code></pre></div></li>
<li><p>Its payload must have at least two claims, ‘exp’ (expiration time) and ‘usr’ (user)</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1"></a><span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="st">&quot;exp&quot;</span><span class="op">:</span> expiration<span class="op">,</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="st">&quot;usr&quot;</span><span class="op">:</span> <span class="st">&quot;username&quot;</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="op">}</span></span></code></pre></div>
<p>where <code>expiration</code> should be two hours from now (in <strong><em>seconds</em></strong> since Unix epoch, Jan 1, 1970) and <code>username</code> should be the authenticated username. Note that the unit of time here is seconds not milliseconds. According to JWT standard, this is how the expiration time should be represented.</p></li>
<li><p>The signature must be generated using the HS256 algorithm (HMAC-SHA256 hash function) with the following secret key</p>
<pre><code>C-UFRaksvPKhx1txJYFcut3QGxsafPmwCY6SCly3G6c</code></pre></li>
</ol>
<p>Once this JWT cookie is set, our server will be able to recognize that any future request from the browser comes from the authenticated user <code>username</code>.</p>
<p>You can use the <a href="https://www.npmjs.com/package/jsonwebtoken">jsonwebtoken module</a> to construct a JWT. Install it with the following command</p>
<pre class="term"><code>$ npm install jsonwebtoken</code></pre>
<p>and learn how to use it by going over examples in the <a href="https://www.npmjs.com/package/jsonwebtoken">jsonwebtoken module page</a>.</p>
<p>Now implement the login page. Remember that after a successful authentication by the user (i.e., the user’s username and password match), the server should generate an appropriate JWT, set it as the value of the cookie <code>jwt</code> (lowercase) and <em>redirect the request to the <code>redirect</code> parameter in the request if it exists.</em> If the authentication fails, (username or password is missing or they don’t match with our record), the server must return a page with the username and password input box, so that they user can try again.</p>
<p>Remember that the user “cs144”’s password is “password” and “user2”’s password is “blogserver” in testing your authentication page.</p>
<h2 id="part-d-implement-blog-management-rest-api">Part D: Implement Blog-Management REST API</h2>
<p>In this part, you will have to implement the REST API that will be used by an Angular-based editor (that will be implemented in Project 4) to save, retrieve, update, and delete the blog posts from the server.</p>
<table>
<colgroup>
<col style="width: 1%" />
<col style="width: 19%" />
<col style="width: 5%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="header">
<th>#</th>
<th>URL</th>
<th>method</th>
<th>functionality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>/api/posts</code></td>
<td>GET, POST, DELETE</td>
<td>This is the REST API used to insert, retrieve, update, and delete blog posts</td>
</tr>
</tbody>
</table>
<p>Here are more detailed descriptions of the above API:</p>
<ol type="1">
<li><p>This REST API must be protected behind authentication. That is, if any request to <code>/api/posts</code> does not contain a valid jwt cookie with matching username (i.e., if the jwt cookie is not included in the HTTP header, if the included jwt has expired, or if the username in jwt does not match the username in the path or the body), the server should reply with “401 (Unauthorized)” status code.</p></li>
<li><p><strong>GET /api/posts?username=:username</strong>: The server should return all blog posts by <code>:username</code>. The returned posts should be included in the body of the response as a JSON array with <code>Content-Type: application/json</code>. Each post in the array should have at least five fields, <code>postid</code>, <code>title</code>, <code>body</code>, <code>created</code>, and <code>modified</code> (case sensitive). If the user does not exist or have no post, return an empty JSON array. If successful, the server should respond with the status code “200 (OK)”.</p></li>
<li><p><strong>GET /api/posts?username=:username&amp;postid=:postid</strong>: The server should return the blog post with <code>:postid</code> by <code>:username</code>. If such a post exists, the response status code should be “200 (OK)”, and the post should be included in a JSON body with at least five fields, <code>postid</code>, <code>title</code>, <code>body</code>, <code>created</code>, and <code>modified</code> (case sensitive). If not, the response status code should be “404 (Not found)”.</p></li>
<li><p><strong>DELETE /api/posts?username=:username&amp;postid=:postid</strong>: The server should delete the existing blog post with <code>:postid</code> by <code>:username</code> from the database. If successful, the server should reply with “204 (No content)” status code. If there is no such post, the server should reply with “404 (Not found)” status code.</p></li>
<li><p><strong>POST /api/posts</strong>: The request body should contain a JSON object (<code>Content-Type: application/json</code>) with four fields, <code>username</code>, <code>postid</code>, <code>title</code>, and <code>body</code>.</p>
<ol type="1">
<li><strong>When <code>postid=0</code></strong>: The server should insert a <em>new</em> blog post whose <code>username</code>, <code>title</code>, and <code>body</code> values come from the request. The inserted <code>postid</code> must be the user’s <code>maxid</code> (i.e., the <code>maxid</code> field of <code>username</code> in the <code>Users</code> collection) + 1, which should never be smaller than 1. The inserted <code>created</code> and <code>modified</code> fields must be the current time. The server must also increase the user’s <code>maxid</code> field by 1 in the <code>Users</code> collection. If successful, the server should reply with “201 (Created)” status code with a JSON body with <code>postid</code>, <code>created</code>, and <code>modified</code> fields that reflect the inserted values.</li>
<li><strong>When <code>postid&gt;0</code></strong>: The server should update the <em>existing blog post</em> with <code>postid</code> by <code>username</code> with the <code>title</code> and <code>body</code> values from the request. The <code>modified</code> field should be updated to the current time as well. If the update is successful, the server should reply with “200 (OK)” status code with a JSON body that has a single <code>modified</code> field with the new modified value. If there is no blog post with <code>postid</code> by <code>username</code>, the server should reply with “404 (Not found)” status code.</li>
</ol></li>
<li><p>All dates transmitted and stored in MongoDB should be in <strong>milliseconds since the the Unix epoch (Jan 1, 1970 UTC) in number type</strong>.</p></li>
<li><p>If a request does not meet our requirements (such as not including required fields, their values are in an incorrect format, etc.), the server must reply with “400 (Bad request)” status code.</p></li>
</ol>
<p>Now add the appropriate routing instruction to your app and implement the above API. Make sure that the implementation works as intended before you proceed. You can test your implementation using the <a href="https://curl.haxx.se/docs/manpage.html">curl command</a> (available within our Docker container) or <a href="https://www.getpostman.com/">Postman</a>, which makes it easy to send an HTTP request to a server.</p>
<p>Once you made sure that everything works fine, protect this REST API behind authentication. That is, before you process any request to this API, first make sure that the request contains a valid jwt cookie with the matching username.</p>
<p><strong>Note</strong>: Please make sure that you <strong><em>return the correct status code according to our spec. If your status code is diffrent from our spec you will get zero point for the part</em></strong>, even if the response body may contain reasonable content.</p>
<h3 id="what-to-submit">What to Submit</h3>
<p>Before you create the submission zip file for Project 3, please make sure that your server can be executed simply by running the following sequence of commands at the project root directory:</p>
<pre class="term"><code>$ mongo &lt; db.sh
$ npm install
$ npm start</code></pre>
<p>Since this is how our autograder will run and test your code, it is essential that your code runs fine without any problem through the above commands. You may assume that the MongoDB server is running with no documents inside the “BlogServer” database when your your server is executed in the autograder.</p>
<p>After you have checked there is no issue with your project, package your work by running our <a href="./p3_package">p3_package</a> script in your project root directory.</p>
<pre><code>blog-server
 +- bin
 +- public
 +- routes
 +- views
 +- ...
 +- package.json
 +- app.js
 +- db.sh</code></pre>
<p>When you execute the packaging script like <code>./p3_package</code> in the project root directory, it will check whether a few mandatory files are there, and package everything within the directory (except the files in <code>node_modules/</code>) and create a file named <code>project3.zip</code>. It will also perform basic sanity check to ensure that your code will run under our autograder. If everything goes smoothly, you will see something like the following at the end:</p>
<pre class="term"><code>[SUCCESS] Created &#39;/home/cs144/shared/blog-server/project3.zip&#39;. Ready for submission.</code></pre>
<p><strong>Please only submit this script-created project3.zip to GradeScope. Do not use any other ways to package or submit your work!</strong></p> 
</body>
</html>
