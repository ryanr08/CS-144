<!DOCTYPE html>
<html lang="en">
<!-- ***IMPORTANT***: This page is autogenerated from a markdown file
         DO NOT EDIT THIS FILE DIRECTLY.
	 Your edits will disappear when this page is regenerated  -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        code{white-space: pre-wrap;}
        span.smallcaps{font-variant: small-caps;}
        span.underline{text-decoration: underline;}
        div.line-block{white-space: pre-line;}
        div.column{display: inline-block; vertical-align: top; width: 50%;}
        pre{background-color:#e7e7e7; border: solid 1px #000000; padding: 5px;}
        code{background-color:#e7e7e7; padding: 1px;}
        code.sourceCode > span { display: inline-block; line-height: 1.25; }
        code.sourceCode > span { color: inherit; text-decoration: inherit; }
        code.sourceCode > span:empty { height: 1.2em; }
        .sourceCode { overflow: visible; }
        code.sourceCode { white-space: pre; position: relative; }
        div.sourceCode { margin: 1em 0; }
        pre.sourceCode { margin: 0; }
        @media screen {
        div.sourceCode { overflow: auto; }
        }
        @media print {
        code.sourceCode { white-space: pre-wrap; }
        code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
        }
        pre.numberSource code
          { counter-reset: source-line 0; }
        pre.numberSource code > span
          { position: relative; left: -4em; counter-increment: source-line; }
        pre.numberSource code > span > a:first-child::before
          { content: counter(source-line);
            position: relative; left: -1em; text-align: right; vertical-align: baseline;
            border: none; display: inline-block;
            -webkit-touch-callout: none; -webkit-user-select: none;
            -khtml-user-select: none; -moz-user-select: none;
            -ms-user-select: none; user-select: none;
            padding: 0 4px; width: 4em;
            color: #aaaaaa;
          }
        pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
        div.sourceCode
          {   }
        @media screen {
        code.sourceCode > span > a:first-child::before { text-decoration: underline; }
        }
        code span.al { color: #ff0000; } /* Alert */
        code span.an { color: #008000; } /* Annotation */
        code span.at { } /* Attribute */
        code span.bu { } /* BuiltIn */
        code span.cf { color: #0000ff; } /* ControlFlow */
        code span.ch { color: #008080; } /* Char */
        code span.cn { } /* Constant */
        code span.co { color: #008000; } /* Comment */
        code span.cv { color: #008000; } /* CommentVar */
        code span.do { color: #008000; } /* Documentation */
        code span.er { color: #ff0000; font-weight: bold; } /* Error */
        code span.ex { } /* Extension */
        code span.im { } /* Import */
        code span.in { color: #008000; } /* Information */
        code span.kw { color: #0000ff; } /* Keyword */
        code span.op { } /* Operator */
        code span.ot { color: #ff4000; } /* Other */
        code span.pp { color: #ff4000; } /* Preprocessor */
        code span.sc { color: #008080; } /* SpecialChar */
        code span.ss { color: #008080; } /* SpecialString */
        code span.st { color: #008080; } /* String */
        code span.va { } /* Variable */
        code span.vs { color: #008080; } /* VerbatimString */
        code span.wa { color: #008000; font-weight: bold; } /* Warning */
        .sourceCode{overflow: auto;}
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body, {delimiters: [ {left: '\\[', right: '\\]', display: true}, {left: '$$', right: '$$', display: true}, {left: '\\(', right: '\\)', display: false}, {left: '$', right: '$', display: false} ]});"></script>
    <link rel="stylesheet" href="/libs/fonts/fonts.css">
    <link rel="stylesheet" href="/libs/css/pandoc.css">
    <title>CS144: Web Applications</title>
</head>
<body>
<h1 id="project-2-tomcat-based-markdown-editor">Project 2: Tomcat-Based Markdown Editor</h1>
<h2 id="overview">Overview</h2>
<p>In Project 2, we will develop an online markdown editor using Apache Tomcat. Through this process we will learn how to develop a Web application using a “traditional” stack, in particular, MySQL and Apache Tomcat (Java servlet).<br />
In later projects, we will use more “modern” Web development stack, such as MongoDB, Node.js, and Angular, but we want to make sure that everyone has an experience with developing Web applications on a more “traditional” stack. This will help students understand and appreciate why modern frameworks are structured as they are. All development for Project 2 will be done on the “tomcat” container that you created from “junghoo/tomcat” image in Project 1. Make sure that the container still starts and works fine by issuing the following command in a terminal window:</p>
<pre class="term"><code>$ docker start -i tomcat</code></pre>
<h2 id="part-a-learn-apache-tomcat">Part A: Learn Apache Tomcat</h2>
<p>Before starting to code, first learn how we develop a Web application using Apache Tomcat by going over our tutorial:</p>
<ul>
<li><a href="../tomcat/index.html">Developing a Web Application on Tomcat</a>.</li>
</ul>
<p>The tutorial teaches how you can develop a Web application using Java Servlet and JSP, and how you can package the set of files needed for your app into a single Web Application Archive (WAR) file for easy deployment on Tomcat.</p>
<h2 id="part-b-learn-jdbc">Part B: Learn JDBC</h2>
<p>In order to access MySQL data from a Java program, you will need to use JDBC (Java DataBase Connectivity) API. Go over the following tutorial to learn how to use JDBC to access MySQL in a Java program.</p>
<ul>
<li><a href="../jdbc/index.html">A short tutorial on JDBC</a></li>
</ul>
<h2 id="part-c-implement-markdown-editor-and-previewer">Part C: Implement Markdown Editor and Previewer</h2>
<p>Now that you have learned how to develop applications on Tomcat and MySQL, it is time to get your real work done. In Part C, you will need to implement an “online markdown editor” that allows users to save and edit blog posts written in <a href="https://en.wikipedia.org/wiki/Markdown">markdown</a>.</p>
<p><a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> is a lightweight and intuitive markup language originally proposed by John Gruber in 2004 to help people “write using an easy-to-read, easy-to-write plain text format, and optionally convert it to structurally valid XHTML (or HTML)”. Due to its simplicity, markdown has become the de-facto standard for writing readme files on many web sites (e.g., <a href="https://github.com/">GitHub</a> and <a href="https://bitbucket.com/">BitBucket</a>). In fact, this page was originally written in markdown and has been converted to HTML using <a href="https://pandoc.org/">Pandoc</a>! Since we will use an <a href="https://github.com/atlassian/commonmark-java">“off-the-shelf” markdown parsing library in Java</a> for this project, you don’t have to learn markdown syntax, but in case you are interested, here is a <a href="http://commonmark.org/help/">2-minute introduction to markdown syntax</a>. For your reference, John Gruber’s description of markdown syntax is available <a href="https://daringfireball.net/projects/markdown/syntax">here</a> (highly recommended if you want to learn more precise syntax) and the result of recent standardization efforts, referred to as CommonMark, is available <a href="http://spec.commonmark.org/">here</a> (extremely detailed and precise, yet boring to read).</p>
<h3 id="pages-within-your-application">“Pages” Within Your Application</h3>
<p>Your Web site should allows users to create a new post (written in markdown), preview the post (rendered in HTML), and manage existing posts. These tasks are supported through three main pages on your Web site: <em>edit</em>, <em>preview</em>, and <em>list</em> pages</p>
<h4 id="edit-page">Edit page</h4>
<div style="float: right;">
<img src="edit-page.png" title="fig:" style="border: 1px solid;" width="250" alt="Edit page" />
</div>
<p>The “edit page” allows editing the title and body of a post.</p>
<ul>
<li><p>The page should contain two input boxes</p>
<ol type="1">
<li>a <em>title</em> <code>&lt;input&gt;</code> box of <code>text</code> type. This text input element <strong>must</strong> have the ID attribute with value “title”.</li>
<li>a <em>body</em> <code>&lt;textarea&gt;</code>. This textarea element <strong>must</strong> have the ID attribute with value “body”.</li>
</ol></li>
<li><p>The page should contain four buttons: <em>save</em>, <em>close</em>, <em>preview</em>, and <em>delete</em>. Once pressed,</p>
<ol type="1">
<li>“save” button saves the content of the post to the database and goes to the “list page”.</li>
<li>“close” button goes to the “list page” without saving the current content.</li>
<li>“preview” button goes to the “preview page” (without saving the current content).</li>
<li>“delete” button deletes the post from the database and goes to the “list page”.</li>
</ol></li>
</ul>
<div style="clear:both;">

</div>
<h4 id="preview-page">Preview page</h4>
<div style="float: right;">
<img src="preview-page.png" title="fig:" style="border: 1px solid;" width="250" alt="Preview page" />
</div>
<p>The “preview page” shows the HTML rendering of a post written in markdown. The page must have a “close” button. Once pressed, close button goes back to the “edit page” of the post.</p>
<div style="clear:both;">

</div>
<h4 id="list-page">List page</h4>
<div style="float: right;">
<img src="list-page.png" title="fig:" style="border: 1px solid;" width="250" alt="List page" />
</div>
<p>The “list page” shows the list of all blog posts saved by the user. The posts in the list should be sorted by their “postid” (a unique integer assigned to a post) in the ascending order. Each item in the list must show:</p>
<ol type="1">
<li><p>title, creation, and modification dates of the post, and</p></li>
<li><p>two buttons: <em>open</em> and <em>delete</em>. Once pressed,</p>
<ul>
<li>“open” button goes to the “edit page” for the post.</li>
<li>“delete” button deletes the post from the database and comes back to the list page.</li>
</ul></li>
</ol>
<p>The list page should also contain a “new post” button to allow users to create a new post. Once pressed, the button should lead to the “edit page” for a new post.</p>
<div style="clear:both;">

</div>
<p>To help you better understand the function of the three pages on your site and their interaction model, we made an example demo site available at <a href="http://oak.cs.ucla.edu/editor/post?action=list&amp;username=junghoo" class="uri">http://oak.cs.ucla.edu/editor/post?action=list&amp;username=junghoo</a>. Note that the demo is just for illustration purposes and may not follow our spec completely. When the behavior of the demo is different from our spec, you need to follow the spec. For security concerns, for example, we do not perform any update operation to our database, so even if you “delete” a post, it won’t disappear from the list. We also removed all CSS styling tags in the demo, so it looks ugly. Despite these, you can still get a basic idea of how the three pages should interact and function.</p>
<p><strong>Note:</strong> The three “pages” that we described above may not necessarily be three separate HTML pages. Depending on your implementation, they may be implemented as one or more HTML pages, Java servlets and/or JSP pages. You may consider “three pages” as <em>three classes of page layouts</em> that your application should use.</p>
<h3 id="server-side-api">Server-Side API</h3>
<p>In developing your application, you should follow the following <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST API</a>. First, you should make your application available at the following path:</p>
<pre><code>/editor/post</code></pre>
<p>Depending on the HTTP method, additional parameters of the form <code>action=type&amp;username=name&amp;postid=num&amp;title=title&amp;body=body</code> may be included either in the path or in the body of the request. The path and the parameters are all case sensitive. The parameter “action” specifies one of five “actions” that your site has to take: <em>open</em>, <em>save</em>, <em>delete</em>, <em>preview</em>, and <em>list</em>. The other four parameters, username, postid, title, and body are (optional) parameters that the actions may need. Here is detailed descriptions of the five actions – their functions and required parameters:</p>
<h4 id="open">open</h4>
<ul>
<li>required parameters: username and postid</li>
<li>function: return the “edit page” for the post with the given postid by the user
<ul>
<li>If postid == 0,
<ul>
<li>if title and body parameters have been passed, use the passed parameter values as the initial title and body values and return with status code 200 (OK)</li>
<li>otherwise, set missing title and/or body to empty string and return with status code 200 (OK)</li>
</ul></li>
<li>If postid &gt; 0,
<ul>
<li>if both title and body parameters have been passed, use the passed parameter values as the initial title and body values and return with status code 200 (OK)</li>
<li>otherwise
<ul>
<li>if (username, postid) row exists in the database, retrieve the title and body from the database and return with status code 200 (OK).</li>
<li>otherwise, return with status code 404 (Not found).</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<h4 id="save">save</h4>
<ul>
<li>required parameters: username, postid, title, and body</li>
<li>function: save the post into the database and go to the “list page” for the user
<ul>
<li>if postid == 0
<ul>
<li>assign a new postid, save the content as a “new post”, and return with status code 200 (OK)</li>
</ul></li>
<li>if postid &gt; 0
<ul>
<li>if (username, postid) row exists in the database, update the row with the new title, body, and modification date and return with status code 200 (OK).</li>
<li>if (username, postid) row does not exist, do not modify the database and return with status code 404 (Not Found).</li>
</ul></li>
</ul></li>
</ul>
<h4 id="delete">delete</h4>
<ul>
<li>required parameters: username and postid</li>
<li>function: delete the corresponding post and “redirect” to the “list page”
<ul>
<li><p>if (username, postid) row exists in the database, delete the row, and return with status code 200 (OK). In the response body, include the HTML redirection meta tag similar to the following, so that the browser will automatically redirect to the “list page”.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">&lt;head&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="kw">&lt;meta</span><span class="ot"> http-equiv=</span><span class="st">&quot;Refresh&quot;</span><span class="ot"> content=</span><span class="st">&quot;0; URL=https://redirected-url.com/&quot;</span><span class="kw">&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">&lt;/head&gt;</span></span></code></pre></div></li>
<li><p>if (username, postid) row does not exist in the database, return with status code 404 (Not Found).</p></li>
</ul></li>
</ul>
<p>To learn different mechanisms to redirect the browser automatically to a different page, read the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Redirections">MDN document on HTTP redirections</a>.</p>
<h4 id="preview">preview</h4>
<ul>
<li>required parameters: username, postid, title, and body</li>
<li>function: return the “preview page” with the html rendering of the given title and body
<ul>
<li>return with status code 200 (OK).</li>
</ul></li>
</ul>
<h4 id="list">list</h4>
<ul>
<li>required parameters: username</li>
<li>function: return the “list page” for the user
<ul>
<li>if username exists in the database, return with status code 200 (OK).</li>
<li>if username does not exist in the database, return with status code 404 (Not Found).</li>
</ul></li>
</ul>
<p><strong>NOTE</strong>:</p>
<ol type="1">
<li>Among the five actions, you should take requests via both GET and POST methods for <em>open</em>, <em>preview</em>, and <em>list</em>, while you should allow <strong>only POST method for <em>save</em> and <em>delete</em></strong>. This is because <em>save</em> and <em>delete</em> leave significant side effects on the server.</li>
<li>When the server cannot handle a request because the request is “invalid” – for example, the request does not include a required parameter – the server must return with a 4XX response status code, such as “400 (Bad request)” or “404 (Not found)”. <strong>The server should never return a 5XX response status code because of an invalid request.</strong> Look up <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">this page</a> to see the list of HTTP response status codes and their meaning. Refer to the <a href="https://tomcat.apache.org/tomcat-8.0-doc/servletapi/javax/servlet/http/HttpServletResponse.html"><code>HttpServletResponse</code> API</a> to learn how to set the HTTP status code in Servlet.</li>
<li>To make the scope of this project manageable, you may assume that the title and body parameters will not contain any HTML tags or JavaScript. You do not need to worry about problems arising from them. In real projects, though, you will have to worry about these issues since they may lead to serious security vulnerabilities.</li>
</ol>
<p><strong>NOTE</strong>: During our grading, we won’t be doing extensive check for security related issues, but there are two things that we may test:</p>
<ol type="1">
<li><p>Your implementation should do the basic input validation. For example, we do expect that students make sure that postid is integer.</p></li>
<li><p>Your implementation should use <code>preparedStatement</code> in your SQL queries as a basic protection against SQL injection attack. As we mentioned in our JDBC tutorial, we expect students to follow this industry-wise convention, which cannot be overemphasized as a minimal security measure.</p></li>
</ol>
<p>Whatever the user input, it will be important that your implementation won’t flake out (like throwing Java exception messages as the output). All requests need to be handled gracefully, however malformed they may be.</p>
<p><strong>Note on Multi-Threading</strong>:</p>
<p>Tomcat creates one thread per each request and concurrent data manipulation can be taken care of by MySQL. This makes server-side programming easy since the programmer doesn’t have to worry about concurrency. But in order to do things this way, you need to keep two things in mind:</p>
<ol type="1">
<li>JDBC API is thread-safe only if each thread uses its own connection. If multiple threads share the same connection, the behavior is unpredictable. Create one DB connection in each servlet request handler, such as <code>doGet()</code> and close it before you return from the handler.</li>
<li>Any servlet request handler <strong>must not use global states</strong>. Any global state that needs to be shared between multiple requests <strong>must be stored and managed by MySQL</strong>. In particular, any servlet request handler, such as <code>doGet()</code> must not reference a class instance variable. It must reference only local variables.</li>
</ol>
<p><strong>Note on Connection Pooling</strong>:</p>
<p>You may think that creating one DB connection per request will lead to too much overhead and wonder whether there is any way to “share” the same DB connection among multiple requests. The proper way to do it is to use <a href="https://tomcat.apache.org/tomcat-8.0-doc/jndi-datasource-examples-howto.html"><em>connection pooling</em></a>, but this is beyond the scope of this project. Connection pooling is something that must be used in a production environment, but you MUST NOT use connection pooling in this project since it won’t work on the grader’s machine.</p>
<h3 id="database-schema">Database Schema</h3>
<p>All blog posts that are saved by the users must be stored as a row a MySQL table with the following schema:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1"></a>Posts(</span>
<span id="cb4-2"><a href="#cb4-2"></a>    username      <span class="dt">VARCHAR</span>(<span class="dv">40</span>),</span>
<span id="cb4-3"><a href="#cb4-3"></a>    postid        <span class="dt">INTEGER</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>    title         <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="kw">body</span>          TEXT,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    modified      <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> <span class="st">&#39;2000-01-01 00:00:00&#39;</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>    created       <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> <span class="st">&#39;2000-01-01 00:00:00&#39;</span>,</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="kw">PRIMARY</span> <span class="kw">KEY</span>(username, postid)</span>
<span id="cb4-9"><a href="#cb4-9"></a>)</span></code></pre></div>
<p>Hopefully, the meaning of each column would be clear from our earlier discussion. MySQL schema definition is case sensitive, so be careful with the case of your schema definition.</p>
<p>Create the table within “CS144” database as the user “cs144”. The first blog post of every user must start with postid=1 and their subsequent posts must be assigned to a linearly increasing postid. Therefore, blog posts by different users may share the same postid, but postid is unique within a single user. Populate the <code>Posts</code> table with the following six initial tuples:</p>
<pre><code>(&#39;user_XYRSAF&#39;, 1, &#39;Post 1 by XYRSAF&#39;, &#39;Article1 written by XYRSAF&#39;, &#39;2020-01-03 10:00:00&#39;, &#39;2020-01-03 09:10:00&#39;)
(&#39;user_XYRSAF&#39;, 2, &#39;Post 2 by XYRSAF&#39;, &#39;Article2 written by XYRSAF&#39;, &#39;2020-01-04 10:00:00&#39;, &#39;2020-01-04 09:10:00&#39;)
(&#39;user_XYRSAF&#39;, 3, &#39;Post 3 by XYRSAF&#39;, &#39;Article3 written by XYRSAF&#39;, &#39;2020-01-05 10:00:00&#39;, &#39;2020-01-05 09:10:00&#39;)
(&#39;user_XYRSAF&#39;, 4, &#39;Post 4 by XYRSAF&#39;, &#39;Article4 written by XYRSAF&#39;, &#39;2020-01-06 10:00:00&#39;, &#39;2020-01-06 09:10:00&#39;)
(&#39;user_ACHERW&#39;, 1, &#39;Post 1 by ACHERW&#39;, &#39;Article1 written by ACHERW&#39;, &#39;2020-01-03 10:00:00&#39;, &#39;2020-01-03 09:10:00&#39;)
(&#39;user_ACHERW&#39;, 2, &#39;Post 2 by ACHERW&#39;, &#39;Article2 written by ACHERW&#39;, &#39;2020-01-04 10:00:00&#39;, &#39;2020-01-04 09:10:00&#39;)</code></pre>
<p>In case you find it helpful, here is a <a href="tuples.txt">text file</a> that contains the six tuples in a format that you can simply “cut-and-paste” into a SQL INSERT statement.</p>
<p>In implementing your app, you may need to create tables other than the “Posts” table to store other information needed for your app persistently.</p>
<h3 id="skeleton-code">Skeleton Code</h3>
<p>To help you get started, we provide skeleton sample code for this project in <a href="project2.zip">project2.zip</a>, which has the following set of files:</p>
<pre><code>project2.zip
 +- build.gradle
 +- create.sql
 +- deploy.sh
 +- src 
    +- main
        +- java
        |   +- Editor.java
        +- webapp
            +- edit.jsp
            +- WEB-INF
                +- web.xml</code></pre>
<ol type="1">
<li><em>create.sql</em>: This file has has a sequence of SQL commands that create “Posts” table in the CS144 database and load <a href="./tuples.txt">the six initial tuples</a> into the table. If you need to create any additional tables for your app, you will need to add the SQL commands to create them in this file.</li>
<li><em>src/main/java/Editor.java</em>: This is a skeleton Java code for servlet implementation. The provided code simply dispatches the request to <em>edit.jsp</em> page, so you will need to implement your application logic as part of the <code>Editor</code> class, such as connecting to, retrieving from, and updating MySQL database server, and dispatching the user’s request to an appropriate JSP page.</li>
<li><em>src/main/webapp/edit.jsp</em>: This is a simple JSP page that contains HTML elements for implementing the “edit page”. You will need to update this page according to our earlier specification.</li>
<li><em>src/main/webapp/WEB-INF/web.xml</em>: This is the Tomcat deployment descriptor file prepared for this project. Currently, it sends any request to <code>/editor</code> to the Java class <code>Editor</code>.</li>
<li><em>build.gradle</em> and <em>deploy.sh</em>: These are gradle “build script” and the app deployment script that you can use to build your WAR file and deploy it to Tomcat. We will explain these scripts in more detail in the next section.</li>
</ol>
<h4 id="gradle-build-script">Gradle build script</h4>
<p>As you learned from our <a href="../tomcat/index.html">tutorial on Tomcat</a>, a Web application needs many files that should be carefully prepared and packaged. To help you focus on coding, not packaging, we included a “gradle build script” that takes care of compilation and packaging. To see how it works, unzip <a href="project2.zip">project2.zip</a> into a folder, <code>cd</code> to the folder and run the following command:</p>
<pre class="term"><code>$ gradle assemble</code></pre>
<p>This will compile all your Java source files in the <code>src/main/java/</code> directory (currently, just “Editor.java”), package them together with everything under <code>src/main/webapp/</code> directory according to the spec, and create a war file at <code>build/libs/editor.war</code>. Once created, you can copy the war file to <code>$CATALINA_BASE/webapps</code>:</p>
<pre class="term"><code>$ cp build/libs/editor.war $CATALINA_BASE/webapps</code></pre>
<p>to deploy it to the Tomcat server. Copy the file, wait for a few seconds (so that Tomcat detects the new war file and sets it up), and access <a href="http://localhost:8888/editor/post?action=list&amp;username=test" class="uri">http://localhost:8888/editor/post?action=list&amp;username=test</a> from a browser on your host. You will get a (non-functional) version of the “edit page” that has been generated from the <code>edit.jsp</code> page.</p>
<p>As long as you can use our provided gradle build script to compile your code and create the war file, it is okay for you to know nothing about how the gradle build script works. But if you want to learn more, read <a href="https://spring.io/guides/gs/gradle/">one of many online tutorials on Gradle</a>.</p>
<p>Your job now is to write Java code in <code>Editor.java</code> and (optionally) add new JSP, HTML pages to <code>src/main/webapp</code> in order to implement Online Markdown Editor. If you are not sure how the code in <code>Editor.java</code> works or how to write a JSP page, go over our <a href="../tomcat/index.html">Tomcat Application Development Tutorial</a>. If you are not sure how to access a MySQL database with a Java code, go over our <a href="../jdbc/index.html">JDBC tutorial</a>.</p>
<p><strong>Note</strong>: You may find it helpful that what is written to <code>System.out/err</code> in Tomcat servlet is (1) printed on console and (2) written to the <code>catalina.out</code> log filelocated in <code>$CATALINA_BASE/logs/</code>.</p>
<h4 id="commonmark-java-library">Commonmark Java Library</h4>
<p>To implement the “preview page”, you need to “compile” a markdown-formatted input into an HTML-formatted output. For this, you can use the <a href="https://github.com/atlassian/commonmark-java">commonmark Java library</a>. We have already downloaded the library and made it available in our “tomcat” container. Go over the the <a href="https://github.com/atlassian/commonmark-java/blob/master/README.md">README.me file on the library page</a> to learn how to use the library. Roughly, the following Java code</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">import</span><span class="im"> org.commonmark.node.*;</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">import</span><span class="im"> org.commonmark.parser.Parser;</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">import</span><span class="im"> org.commonmark.renderer.html.HtmlRenderer;</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>...</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="bu">Parser</span> parser = <span class="bu">Parser</span>.<span class="fu">builder</span>().<span class="fu">build</span>();</span>
<span id="cb9-6"><a href="#cb9-6"></a>HtmlRenderer renderer = HtmlRenderer.<span class="fu">builder</span>().<span class="fu">build</span>();</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="bu">String</span> markdown = <span class="st">&quot;This is *CS144*&quot;</span>;</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="bu">String</span> html = renderer.<span class="fu">render</span>(parser.<span class="fu">parse</span>(markdown));  </span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">/* html has the string &quot;&lt;p&gt;This is &lt;em&gt;CS144&lt;/em&gt;&lt;/p&gt;\n&quot; */</span></span></code></pre></div>
<p>will “compile” the markdown text <code>This is *CS144*</code> into HTML text <code>&lt;p&gt;This is &lt;em&gt;CS144&lt;/em&gt;&lt;/p&gt;</code>.</p>
<h4 id="deployment-script-deploy.sh">Deployment Script <code>deploy.sh</code></h4>
<p>In <a href="project2.zip">project2.zip</a>, we also included our “deployment bash script”, deployment.sh, that automates the entire application deployment process. In particular, it (1) creates tables for our application in MySQL (2) build the “editor.war” file and (3) deploy it to the Tomcat server. Once you finish developing your code, make sure that simply running</p>
<pre class="term"><code>$ ./deploy.sh</code></pre>
<p>properly sets up your application. This script will be used to deploy your application during our grading, so it is <strong><em>extremely important</em></strong> to make sure that this script works without any error.</p>
<h2 id="your-final-submission">Your Final Submission</h2>
<p>Your project must be submitted electronically before the deadline via GradeScope.</p>
<h3 id="what-to-submit">What to Submit</h3>
<p>You should submit a single file named project2.zip that roughly has the following contents:</p>
<pre><code>project2.zip
 +- README.txt (optional)
 +- deploy.sh
 +- build.gradle
 +- create.sql
 +- src 
    +- main
        +- java
        |   +- Editor.java (and other java files that you wrote)
        +- webapp
            +- edit.jsp (and other jsp, css, and html files that you added)
            +- WEB-INF
                +- web.xml</code></pre>
<p>We have already explained what most of the above files are earlier, but your submission should include the following additional files:</p>
<ol type="1">
<li>README.txt: This optional file should include any information that you need to communicate to the grader.</li>
<li>Please ensure that your <code>create.sql</code> file inserts <a href="./tuples.txt">the six initial tuples</a> into <code>Posts</code> table.</li>
</ol>
<p>Please ensure that your submission is packaged correctly with all required files, but not compiled Java class or WAR files. Make sure that each file is correctly named (including its case). Perhaps, the most important requirement of your submission is that <strong><em>the grader should be able to deploy a fully-functional version of your Web site just by running <code>./deploy.sh</code></em></strong> after unzipping your submission. <strong>You may get as small as zero points if the grader encounters an error due to incorrect packaging, missing files, and failure to follow our exact spec.</strong></p>
<p>To help you package your submission zip file, we prepared “a packaging script” <a href="./p2_package">p2_package</a>. After downloading the script in the directory that has your Project 2 file, set its executable permission and run it as follows:</p>
<pre class="term"><code>$ wget http://oak.cs.ucla.edu/classes/cs144/project1/p2_package
$ chmod +x ./p2_package
$ ./p2_package
  adding: deploy.sh (deflated 36%)
  adding: create.sql (deflated 69%)
  adding: readme.me (deflated 43%)
  adding: group.txt (stored 0%)
  adding: src/ (stored 0%)
  adding: src/main/ (stored 0%)
  adding: src/main/webapp/ (stored 0%)
  adding: src/main/webapp/edit.jsp (deflated 62%)
  adding: src/main/webapp/preview.jsp (deflated 61%)
  adding: src/main/webapp/list.jsp (deflated 65%)
  adding: src/main/webapp/error.jsp (deflated 60%)
  adding: src/main/webapp/WEB-INF/ (stored 0%)
  adding: src/main/webapp/WEB-INF/web.xml (deflated 56%)
  adding: src/main/java/ (stored 0%)
  adding: src/main/java/Editor.java (deflated 79%)
  adding: build.gradle (deflated 8%)
[SUCCESS] Created &#39;/home/cs144/p2/project2.zip&#39;</code></pre>
<p>When executed, our packaging script will collect all necessary (and optional) files located in the current directory and create the <code>project2.zip</code> file according to our specification that can be submitted to GradeScope.</p> 
</body>
</html>
